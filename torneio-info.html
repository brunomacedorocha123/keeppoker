<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Detalhes do Torneio - KeepPoker</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    
    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyBIBucZSzN671VgJQHGIiepHNUqxbqNKAQ",
            authDomain: "keeppoker-b4173.firebaseapp.com",
            projectId: "keeppoker-b4173",
            storageBucket: "keeppoker-b4173.firebasestorage.app",
            messagingSenderId: "436464592434",
            appId: "1:436464592434:web:c5a1e0c10e10acbc14fe2b"
        };
        
        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();
    </script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        :root {
            --azul-profundo: #0d1b2a;
            --azul-medio: #1b263b;
            --azul-claro: #415a77;
            --dourado: #d4af37;
            --dourado-claro: #f7ef8a;
            --branco: #ffffff;
            --cinza-claro: #e0e1dd;
            --verde: #2ecc71;
            --vermelho: #e74c3c;
            --roxo: #9b59b6;
            --laranja: #e67e22;
            --turquesa: #1abc9c;
        }
        
        body {
            background-color: var(--azul-profundo);
            color: var(--cinza-claro);
            line-height: 1.6;
            min-height: 100vh;
        }
        
        .container {
            width: 90%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 15px;
        }
        
        /* Header Superior */
        .top-header {
            background-color: var(--azul-medio);
            padding: 12px 0;
            border-bottom: 2px solid var(--dourado);
        }
        
        .top-header-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 20px;
        }
        
        .player-info {
            display: flex;
            align-items: center;
            gap: 25px;
            flex-wrap: wrap;
        }
        
        .player-id {
            background-color: rgba(212, 175, 55, 0.15);
            padding: 10px 18px;
            border-radius: 25px;
            border: 1.5px solid var(--dourado);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .player-id-label {
            color: var(--cinza-claro);
            font-size: 14px;
            font-weight: 500;
        }
        
        .player-id-value {
            color: var(--dourado-claro);
            font-weight: bold;
            font-size: 16px;
        }
        
        .resources {
            display: flex;
            align-items: center;
            gap: 20px;
        }
        
        .resource-item {
            display: flex;
            align-items: center;
            gap: 10px;
            background: rgba(255, 255, 255, 0.08);
            padding: 10px 18px;
            border-radius: 25px;
            transition: all 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .resource-item:hover {
            background: rgba(212, 175, 55, 0.2);
            transform: translateY(-3px);
        }
        
        .resource-icon {
            font-size: 22px;
        }
        
        .diamond {
            color: var(--turquesa);
        }
        
        .gold {
            color: var(--dourado);
        }
        
        .resource-value {
            font-weight: 700;
            font-size: 18px;
        }
        
        .diamond-value {
            color: var(--turquesa);
        }
        
        .gold-value {
            color: var(--dourado-claro);
        }
        
        .time-section {
            display: flex;
            align-items: center;
            gap: 12px;
            color: var(--cinza-claro);
            background: rgba(255, 255, 255, 0.05);
            padding: 8px 16px;
            border-radius: 20px;
        }
        
        .current-time {
            font-weight: bold;
            color: var(--dourado);
            font-size: 16px;
        }
        
        /* Header Principal */
        .main-header {
            background: rgba(13, 27, 42, 0.98);
            padding: 18px 0;
            position: sticky;
            top: 0;
            z-index: 1000;
            border-bottom: 1px solid rgba(212, 175, 55, 0.3);
        }
        
        .main-header-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo-container {
            height: 65px;
            display: flex;
            align-items: center;
        }
        
        .logo-link {
            display: block;
            height: 100%;
        }
        
        .logo {
            height: 100%;
            width: auto;
            max-width: 220px;
            object-fit: contain;
        }
        
        /* Menu de Navega√ß√£o */
        .nav-menu {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .nav-item {
            position: relative;
        }
        
        .nav-link {
            color: var(--cinza-claro);
            text-decoration: none;
            font-weight: 600;
            font-size: 16px;
            padding: 14px 20px;
            border-radius: 12px;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
            white-space: nowrap;
        }
        
        .nav-link:hover {
            color: var(--dourado-claro);
            background: rgba(212, 175, 55, 0.15);
        }
        
        .nav-link.active {
            color: var(--dourado-claro);
            background: rgba(212, 175, 55, 0.25);
            border-bottom: 3px solid var(--dourado);
        }
        
        .user-menu {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-left: 20px;
        }
        
        .btn {
            padding: 12px 24px;
            border-radius: 30px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
            font-size: 15px;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            white-space: nowrap;
        }
        
        .btn-deposit {
            background: var(--verde);
            color: white;
            border: 2px solid var(--verde);
        }
        
        .btn-deposit:hover {
            background: transparent;
            color: var(--verde);
            transform: translateY(-2px);
        }
        
        .btn-logout {
            background: transparent;
            color: var(--vermelho);
            border: 2px solid var(--vermelho);
        }
        
        .btn-logout:hover {
            background: var(--vermelho);
            color: white;
            transform: translateY(-2px);
        }
        
        /* Menu Mobile */
        .mobile-menu-btn {
            display: none;
            background: none;
            border: none;
            color: var(--dourado);
            font-size: 28px;
            cursor: pointer;
            padding: 8px;
        }
        
        /* Cabe√ßalho do Torneio - SEM TIMER */
        .tournament-header {
            padding: 40px 0;
            text-align: center;
            background: linear-gradient(135deg, rgba(27, 38, 59, 0.9) 0%, rgba(13, 27, 42, 0.9) 100%);
            border-bottom: 3px solid var(--dourado);
            margin-bottom: 40px;
        }
        
        .tournament-badge {
            display: inline-block;
            padding: 8px 20px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 20px;
        }
        
        .badge-registering {
            background: var(--verde);
            color: white;
        }
        
        .badge-running {
            background: var(--laranja);
            color: white;
        }
        
        .badge-scheduled {
            background: var(--roxo);
            color: white;
        }
        
        .badge-finished {
            background: #95a5a6;
            color: white;
        }
        
        .tournament-title {
            font-size: 42px;
            font-weight: 700;
            color: var(--branco);
            margin-bottom: 15px;
        }
        
        .tournament-subtitle {
            font-size: 18px;
            color: var(--cinza-claro);
            max-width: 600px;
            margin: 0 auto 25px;
        }
        
        /* Info de Aguardo */
        .waiting-info {
            background: rgba(0, 0, 0, 0.5);
            display: inline-block;
            padding: 15px 30px;
            border-radius: 15px;
            border: 2px solid var(--dourado);
            margin-top: 20px;
        }
        
        .waiting-label {
            font-size: 14px;
            color: var(--cinza-claro);
            margin-bottom: 10px;
        }
        
        .waiting-value {
            font-size: 20px;
            font-weight: 700;
            color: var(--dourado-claro);
        }
        
        /* Layout Principal */
        .main-content {
            display: grid;
            grid-template-columns: 1fr 350px;
            gap: 30px;
            margin-bottom: 60px;
        }
        
        @media (max-width: 992px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }
        
        /* Painel Esquerdo - Informa√ß√µes */
        .info-panel {
            background: var(--azul-medio);
            border-radius: 20px;
            padding: 30px;
            border: 2px solid rgba(212, 175, 55, 0.3);
        }
        
        .section-title {
            color: var(--dourado);
            font-size: 24px;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid rgba(212, 175, 55, 0.2);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        /* Estat√≠sticas do Torneio */
        .tournament-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }
        
        .stat-card {
            background: rgba(255, 255, 255, 0.05);
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            border: 1px solid rgba(212, 175, 55, 0.2);
        }
        
        .stat-icon {
            font-size: 28px;
            color: var(--dourado);
            margin-bottom: 10px;
        }
        
        .stat-value {
            font-size: 28px;
            font-weight: 700;
            color: var(--dourado-claro);
            margin-bottom: 5px;
        }
        
        .stat-label {
            font-size: 14px;
            color: var(--cinza-claro);
        }
        
        /* Estrutura de Blinds */
        .blinds-table {
            width: 100%;
            border-collapse: collapse;
            margin: 25px 0;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 12px;
            overflow: hidden;
        }
        
        .blinds-table th {
            background: rgba(212, 175, 55, 0.2);
            color: var(--dourado-claro);
            padding: 15px;
            text-align: left;
            font-weight: 600;
            font-size: 14px;
            text-transform: uppercase;
        }
        
        .blinds-table td {
            padding: 12px 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            color: var(--cinza-claro);
        }
        
        .blinds-table tr:last-child td {
            border-bottom: none;
        }
        
        .blinds-table tr.current-level {
            background: rgba(212, 175, 55, 0.1);
            color: var(--dourado-claro);
        }
        
        .blinds-table tr.current-level td {
            color: var(--dourado-claro);
            font-weight: 600;
        }
        
        /* Pr√™mios */
        .prizes-table {
            width: 100%;
            border-collapse: collapse;
            margin: 25px 0;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 12px;
            overflow: hidden;
        }
        
        .prizes-table th {
            background: rgba(212, 175, 55, 0.2);
            color: var(--dourado-claro);
            padding: 15px;
            text-align: left;
            font-weight: 600;
            font-size: 14px;
            text-transform: uppercase;
        }
        
        .prizes-table td {
            padding: 12px 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            color: var(--cinza-claro);
        }
        
        .prize-amount {
            color: var(--dourado-claro);
            font-weight: 600;
        }
        
        /* Painel Direito - A√ß√µes & Jogadores */
        .action-panel {
            background: var(--azul-medio);
            border-radius: 20px;
            padding: 30px;
            border: 2px solid rgba(212, 175, 55, 0.3);
            position: sticky;
            top: 100px;
            height: fit-content;
        }
        
        .main-action {
            margin-bottom: 30px;
        }
        
        .btn-tournament {
            width: 100%;
            padding: 20px;
            border-radius: 15px;
            font-weight: 700;
            cursor: pointer;
            border: none;
            transition: all 0.3s ease;
            text-align: center;
            text-decoration: none;
            font-size: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .btn-register {
            background: var(--verde);
            color: white;
        }
        
        .btn-register:hover {
            background: #25a25a;
            transform: translateY(-3px);
        }
        
        .btn-registered {
            background: var(--turquesa);
            color: white;
        }
        
        .btn-registered:hover {
            background: #16a085;
            transform: translateY(-3px);
        }
        
        .btn-enter {
            background: var(--dourado);
            color: var(--azul-profundo);
            font-weight: 700;
        }
        
        .btn-enter:hover {
            background: var(--dourado-claro);
            transform: translateY(-3px);
        }
        
        .btn-watch {
            background: var(--roxo);
            color: white;
        }
        
        .btn-watch:hover {
            background: #8e44ad;
            transform: translateY(-3px);
        }
        
        .btn-disabled {
            background: #95a5a6;
            color: white;
            cursor: not-allowed;
        }
        
        .action-info {
            background: rgba(255, 255, 255, 0.05);
            padding: 15px;
            border-radius: 10px;
            margin-top: 20px;
            font-size: 14px;
            color: var(--cinza-claro);
        }
        
        /* Lista de Jogadores */
        .players-list {
            margin-top: 30px;
        }
        
        .players-count {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .players-title {
            color: var(--cinza-claro);
            font-weight: 600;
        }
        
        .player-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 12px 15px;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 10px;
            margin-bottom: 10px;
            transition: all 0.3s ease;
        }
        
        .player-item:hover {
            background: rgba(212, 175, 55, 0.1);
        }
        
        .player-item.you {
            background: rgba(212, 175, 55, 0.15);
            border-left: 4px solid var(--dourado);
        }
        
        .player-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--azul-claro), var(--azul-medio));
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            color: var(--cinza-claro);
        }
        
        .player-info-small {
            flex: 1;
        }
        
        .player-name {
            color: var(--cinza-claro);
            font-weight: 600;
        }
        
        .player-chips {
            color: var(--dourado);
            font-size: 12px;
            font-weight: 600;
        }
        
        .player-position {
            background: var(--dourado);
            color: var(--azul-profundo);
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 700;
        }
        
        /* Regras e Informa√ß√µes */
        .rules-section {
            background: var(--azul-medio);
            border-radius: 20px;
            padding: 30px;
            border: 2px solid rgba(212, 175, 55, 0.3);
            margin-top: 40px;
        }
        
        .rules-list {
            list-style: none;
            margin: 20px 0;
        }
        
        .rules-list li {
            padding: 10px 0;
            padding-left: 25px;
            position: relative;
            color: var(--cinza-claro);
        }
        
        .rules-list li:before {
            content: '‚úì';
            position: absolute;
            left: 0;
            color: var(--verde);
            font-weight: bold;
        }
        
        /* Loading */
        .loading-container {
            text-align: center;
            padding: 100px 0;
        }
        
        .loading-spinner {
            font-size: 50px;
            color: var(--dourado);
            margin-bottom: 20px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .loading-text {
            color: var(--cinza-claro);
            font-size: 20px;
        }
        
        /* Notifica√ß√µes */
        .notification-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 10000;
        }
        
        .notification {
            padding: 18px 24px;
            border-radius: 12px;
            color: white;
            font-weight: 600;
            margin-bottom: 15px;
            display: none;
            animation: slideIn 0.4s ease;
        }
        
        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        .notification.success {
            background: var(--verde);
        }
        
        .notification.error {
            background: var(--vermelho);
        }
        
        .notification.info {
            background: var(--azul-claro);
        }
        
        /* Footer */
        footer {
            background: #0a1520;
            padding: 60px 0 25px;
            text-align: center;
            border-top: 3px solid var(--dourado);
        }
        
        .footer-logo {
            color: var(--dourado);
            font-size: 36px;
            font-weight: bold;
            margin-bottom: 25px;
        }
        
        .footer-links {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 25px;
            margin-bottom: 35px;
        }
        
        .footer-links a {
            color: var(--cinza-claro);
            text-decoration: none;
            transition: all 0.3s ease;
            font-weight: 500;
        }
        
        .footer-links a:hover {
            color: var(--dourado);
        }
        
        .copyright {
            padding-top: 25px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            color: var(--azul-claro);
            font-size: 14px;
        }
        
        /* Modal de Confirma√ß√£o */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            z-index: 10001;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .modal-content {
            background: var(--azul-medio);
            border-radius: 20px;
            padding: 40px;
            max-width: 500px;
            width: 100%;
            border: 3px solid var(--dourado);
            color: var(--cinza-claro);
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }
        
        .modal-title {
            color: var(--dourado);
            font-size: 24px;
            font-weight: 700;
        }
        
        .modal-close {
            background: none;
            border: none;
            color: var(--cinza-claro);
            font-size: 24px;
            cursor: pointer;
            padding: 5px;
        }
        
        .modal-body {
            margin-bottom: 30px;
            line-height: 1.6;
        }
        
        .modal-actions {
            display: flex;
            gap: 15px;
        }
        
        .btn-modal {
            flex: 1;
            padding: 15px;
            border-radius: 10px;
            font-weight: 700;
            cursor: pointer;
            border: none;
            transition: all 0.3s ease;
        }
        
        .btn-confirm {
            background: var(--verde);
            color: white;
        }
        
        .btn-cancel {
            background: var(--vermelho);
            color: white;
        }
        
        /* Responsividade */
        @media (max-width: 992px) {
            .nav-menu {
                position: fixed;
                top: 140px;
                left: 0;
                width: 100%;
                background: var(--azul-medio);
                flex-direction: column;
                padding: 25px;
                display: none;
                z-index: 999;
            }
            
            .nav-open {
                display: flex;
            }
            
            .nav-item {
                width: 100%;
            }
            
            .nav-link {
                justify-content: center;
                padding: 18px;
            }
            
            .user-menu {
                margin-left: 0;
                width: 100%;
                justify-content: center;
                margin-top: 25px;
                flex-direction: column;
                gap: 15px;
            }
            
            .mobile-menu-btn {
                display: block;
            }
            
            .tournament-title {
                font-size: 32px;
            }
        }
        
        @media (max-width: 576px) {
            .tournament-title {
                font-size: 28px;
            }
            
            .tournament-stats {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>
<body>
    <!-- Notifica√ß√µes -->
    <div class="notification-container">
        <div id="notification" class="notification"></div>
    </div>
    
    <!-- Modal de Confirma√ß√£o -->
    <div id="confirmationModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="modalTitle">Confirmar Inscri√ß√£o</h3>
                <button class="modal-close" onclick="closeModal()">&times;</button>
            </div>
            <div class="modal-body" id="modalBody">
                Deseja realmente se inscrever neste torneio?
            </div>
            <div class="modal-actions">
                <button class="btn-modal btn-cancel" onclick="closeModal()">Cancelar</button>
                <button class="btn-modal btn-confirm" onclick="confirmRegistration()">Confirmar</button>
            </div>
        </div>
    </div>
    
    <!-- Header Superior -->
    <header class="top-header">
        <div class="container top-header-container">
            <div class="player-info">
                <div class="player-id">
                    <span class="player-id-label">ID do Jogador:</span>
                    <span class="player-id-value" id="playerId">-</span>
                </div>
                
                <div class="resources">
                    <div class="resource-item">
                        <i class="fas fa-gem diamond resource-icon"></i>
                        <span class="diamond-value resource-value" id="diamondCount">0</span>
                    </div>
                    
                    <div class="resource-item">
                        <i class="fas fa-coins gold resource-icon"></i>
                        <span class="gold-value resource-value" id="goldCount">0</span>
                    </div>
                </div>
            </div>
            
            <div class="time-section">
                <i class="far fa-clock"></i>
                <span id="currentTime" class="current-time">00:00:00</span>
            </div>
        </div>
    </header>
    
    <!-- Header Principal -->
    <header class="main-header">
        <div class="container main-header-container">
            <div class="logo-container">
                <a href="home.html" class="logo-link">
                    <img src="logokeeppoker.png" alt="KeepPoker" class="logo">
                </a>
            </div>
            
            <button class="mobile-menu-btn" id="mobileMenuBtn">
                <i class="fas fa-bars"></i>
            </button>
            
            <nav class="nav-menu" id="navMenu">
                <div class="nav-item">
                    <a href="mesas.html" class="nav-link">
                        <i class="fas fa-table"></i>
                        <span>Mesas (Cash)</span>
                    </a>
                </div>
                
                <div class="nav-item">
                    <a href="torneios.html" class="nav-link active">
                        <i class="fas fa-trophy"></i>
                        <span>Torneios</span>
                    </a>
                </div>
                
                <div class="nav-item">
                    <a href="ranking.html" class="nav-link">
                        <i class="fas fa-trophy"></i>
                        <span>Ranking</span>
                    </a>
                </div>
                
                <div class="nav-item">
                    <a href="notificacoes.html" class="nav-link">
                        <i class="fas fa-bell"></i>
                        <span>Notifica√ß√µes</span>
                    </a>
                </div>
                
                <div class="nav-item">
                    <a href="clube.html" class="nav-link">
                        <i class="fas fa-users"></i>
                        <span>Meu Clube</span>
                    </a>
                </div>
                
                <div class="nav-item">
                    <a href="minha-conta.html" class="nav-link">
                        <i class="fas fa-user-circle"></i>
                        <span>Minha Conta</span>
                    </a>
                </div>
                
                <div class="user-menu">
                    <button id="depositBtn" class="btn btn-deposit">
                        <i class="fas fa-plus-circle"></i> Depositar
                    </button>
                    <button id="logoutBtn" class="btn btn-logout">
                        <i class="fas fa-sign-out-alt"></i> Sair
                    </button>
                </div>
            </nav>
        </div>
    </header>
    
    <!-- Loading Principal -->
    <div id="mainLoading" class="loading-container">
        <div class="loading-spinner">
            <i class="fas fa-spinner fa-spin"></i>
        </div>
        <p class="loading-text">Carregando informa√ß√µes do torneio...</p>
    </div>
    
    <!-- Conte√∫do Principal (inicialmente oculto) -->
    <div id="mainContent" style="display: none;">
        <!-- Cabe√ßalho do Torneio - SEM TIMER -->
        <section class="tournament-header">
            <div class="container">
                <div class="tournament-badge" id="tournamentBadge">Carregando...</div>
                <h1 class="tournament-title" id="tournamentTitle">Nome do Torneio</h1>
                <p class="tournament-subtitle" id="tournamentSubtitle">Descri√ß√£o do torneio</p>
                
                <!-- Info de Aguardo -->
                <div class="waiting-info" id="waitingInfo">
                    <div class="waiting-label">Aguardando jogadores:</div>
                    <div class="waiting-value" id="waitingValue">0/6</div>
                </div>
            </div>
        </section>
        
        <!-- Conte√∫do Principal -->
        <div class="container">
            <div class="main-content">
                <!-- Painel Esquerdo - Informa√ß√µes -->
                <div class="info-panel">
                    <!-- Estat√≠sticas -->
                    <h2 class="section-title"><i class="fas fa-chart-bar"></i> Estat√≠sticas do Torneio</h2>
                    <div class="tournament-stats" id="tournamentStats">
                        <!-- Estat√≠sticas ser√£o preenchidas por JS -->
                    </div>
                    
                    <!-- Estrutura de Blinds -->
                    <h2 class="section-title"><i class="fas fa-chart-line"></i> Estrutura de Blinds</h2>
                    <table class="blinds-table" id="blindsTable">
                        <thead>
                            <tr>
                                <th>N√≠vel</th>
                                <th>Small Blind</th>
                                <th>Big Blind</th>
                                <th>Ante</th>
                                <th>Dura√ß√£o</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Dados ser√£o preenchidos por JS -->
                        </tbody>
                    </table>
                    
                    <!-- Pr√™mios -->
                    <h2 class="section-title"><i class="fas fa-award"></i> Pr√™mios</h2>
                    <table class="prizes-table" id="prizesTable">
                        <thead>
                            <tr>
                                <th>Posi√ß√£o</th>
                                <th>% do Pr√™mio</th>
                                <th>Valor (Fichas)</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Dados ser√£o preenchidas por JS -->
                        </tbody>
                    </table>
                    
                    <!-- Regras -->
                    <h2 class="section-title"><i class="fas fa-book"></i> Regras do Torneio</h2>
                    <div class="rules-section">
                        <ul class="rules-list" id="rulesList">
                            <!-- Regras ser√£o preenchidas por JS -->
                        </ul>
                    </div>
                </div>
                
                <!-- Painel Direito - A√ß√µes & Jogadores -->
                <div class="action-panel">
                    <!-- A√ß√£o Principal -->
                    <div class="main-action">
                        <button class="btn-tournament" id="mainActionButton">
                            <i class="fas fa-spinner fa-spin"></i> Carregando...
                        </button>
                        <div class="action-info" id="actionInfo">
                            Informa√ß√µes sobre a a√ß√£o dispon√≠vel
                        </div>
                    </div>
                    
                    <!-- Lista de Jogadores -->
                    <div class="players-list">
                        <div class="players-count">
                            <div class="players-title">Jogadores Inscritos</div>
                            <div id="playersCount">0/0</div>
                        </div>
                        <div id="playersList">
                            <!-- Lista de jogadores ser√° preenchida por JS -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Footer -->
    <footer>
        <div class="container">
            <div class="footer-logo">KeepPoker</div>
            
            <div class="footer-links">
                <a href="suporte.html">Suporte</a>
                <a href="faq.html">FAQ</a>
                <a href="regras.html">Regras</a>
                <a href="responsavel.html">Jogo Respons√°vel</a>
                <a href="termos.html">Termos</a>
                <a href="privacidade.html">Privacidade</a>
            </div>
            
            <p class="copyright">
                &copy; 2024 KeepPoker. Todos os direitos reservados. Jogue com responsabilidade.
            </p>
        </div>
    </footer>

    <script>
    // Vari√°veis globais
    let currentUser = null;
    let userData = null;
    let currentTournament = null;
    let tournamentUnsubscribe = null;
    let isUserRegistered = false;
    let currentTournamentToRegister = null;
    
    // Inicializa√ß√£o
    document.addEventListener('DOMContentLoaded', function() {
        console.log('DOM carregado - Iniciando Torneio Info');
        
        // Obter ID do torneio da URL
        const urlParams = new URLSearchParams(window.location.search);
        const tournamentId = urlParams.get('tournamentId');
        
        if (!tournamentId) {
            showNotification('‚ùå ID do torneio n√£o especificado', 'error');
            setTimeout(() => {
                window.location.href = 'torneios.html';
            }, 2000);
            return;
        }
        
        console.log('Carregando torneio ID:', tournamentId);
        
        // Verificar autentica√ß√£o
        auth.onAuthStateChanged(async function(user) {
            console.log('Estado de autentica√ß√£o:', user ? 'Usu√°rio logado' : 'N√£o logado');
            if (user) {
                currentUser = user;
                console.log('UID do usu√°rio:', user.uid);
                await loadUserData();
                loadTournamentData(tournamentId);
                setupTournamentListener(tournamentId);
            } else {
                console.log('Redirecionando para login...');
                window.location.href = 'login.html';
            }
        });
        
        // Inicializar rel√≥gio
        updateClock();
        setInterval(updateClock, 1000);
        
        // Menu mobile
        const mobileMenuBtn = document.getElementById('mobileMenuBtn');
        const navMenu = document.getElementById('navMenu');
        if (mobileMenuBtn) {
            mobileMenuBtn.addEventListener('click', function() {
                navMenu.classList.toggle('nav-open');
                const icon = this.querySelector('i');
                if (navMenu.classList.contains('nav-open')) {
                    icon.classList.remove('fa-bars');
                    icon.classList.add('fa-times');
                } else {
                    icon.classList.remove('fa-times');
                    icon.classList.add('fa-bars');
                }
            });
        }
        
        // Logout
        const logoutBtn = document.getElementById('logoutBtn');
        if (logoutBtn) {
            logoutBtn.addEventListener('click', function() {
                auth.signOut().then(() => {
                    localStorage.removeItem('keepPokerUser');
                    window.location.href = 'index.html';
                }).catch(error => {
                    console.error('Erro ao fazer logout:', error);
                    localStorage.removeItem('keepPokerUser');
                    window.location.href = 'index.html';
                });
            });
        }
        
        // Depositar
        const depositBtn = document.getElementById('depositBtn');
        if (depositBtn) {
            depositBtn.addEventListener('click', function() {
                showNotification('Funcionalidade de dep√≥sito em desenvolvimento', 'info');
            });
        }
    });
    
    // Carregar dados do usu√°rio
    async function loadUserData() {
        try {
            console.log('Carregando dados do usu√°rio...');
            if (!currentUser) {
                console.error('Usu√°rio n√£o autenticado');
                return;
            }
            
            const userDoc = await db.collection('users').doc(currentUser.uid).get();
            if (userDoc.exists) {
                userData = userDoc.data();
                userData.id = userDoc.id;
                
                console.log('Dados do usu√°rio carregados:', userData);
                
                // Atualizar header
                if (document.getElementById('playerId')) {
                    document.getElementById('playerId').textContent = userData.playerId || '-';
                    document.getElementById('diamondCount').textContent = userData.diamantes || '0';
                    document.getElementById('goldCount').textContent = userData.saldo || '0';
                }
            } else {
                console.error('Documento do usu√°rio n√£o encontrado no Firestore');
            }
        } catch (error) {
            console.error('Erro ao carregar dados do usu√°rio:', error);
        }
    }
    
    // Carregar dados do torneio
    async function loadTournamentData(tournamentId) {
        console.log('Carregando dados do torneio:', tournamentId);
        
        try {
            const tournamentDoc = await db.collection('tournaments').doc(tournamentId).get();
            
            if (!tournamentDoc.exists) {
                showNotification('‚ùå Torneio n√£o encontrado', 'error');
                setTimeout(() => {
                    window.location.href = 'torneios.html';
                }, 2000);
                return;
            }
            
            currentTournament = tournamentDoc.data();
            currentTournament.id = tournamentId;
            
            console.log('Dados do torneio carregados:', currentTournament);
            
            // Verificar se usu√°rio est√° inscrito
            isUserRegistered = currentTournament.players?.some(p => p.userId === currentUser?.uid) || false;
            
            // Atualizar interface
            updateTournamentUI();
            
        } catch (error) {
            console.error('Erro ao carregar dados do torneio:', error);
            showNotification('‚ùå Erro ao carregar torneio: ' + error.message, 'error');
        }
    }
    
    // Configurar listener em tempo real para o torneio
    function setupTournamentListener(tournamentId) {
        console.log('Configurando listener para torneio:', tournamentId);
        
        try {
            tournamentUnsubscribe = db.collection('tournaments').doc(tournamentId)
                .onSnapshot((doc) => {
                    console.log('Listener: Torneio atualizado no Firestore');
                    
                    if (doc.exists) {
                        currentTournament = doc.data();
                        currentTournament.id = tournamentId;
                        
                        // Verificar se usu√°rio est√° inscrito
                        isUserRegistered = currentTournament.players?.some(p => p.userId === currentUser?.uid) || false;
                        
                        // Atualizar interface
                        updateTournamentUI();
                        
                        // Verificar se torneio come√ßou (tem 6 jogadores)
                        checkIfTournamentStarted();
                    }
                }, (error) => {
                    console.error('Erro no listener do torneio:', error);
                });
            
        } catch (error) {
            console.error('Erro ao configurar listener:', error);
        }
    }
    
    // Verificar se torneio come√ßou (quando tiver 6 jogadores)
    function checkIfTournamentStarted() {
        if (!currentTournament || currentTournament.status !== 'registering') {
            return;
        }
        
        const playersCount = currentTournament.registeredPlayers || 0;
        const maxPlayers = currentTournament.maxPlayers || 6;
        
        // Se torneio lotou, mudar status para 'starting' (iniciando)
        if (playersCount >= maxPlayers && currentTournament.status === 'registering') {
            console.log('Torneio lotado! Mudando status para starting...');
            
            // Aqui voc√™ pode adicionar l√≥gica para mudar status no Firestore
            // Por enquanto apenas atualizamos a UI
            document.getElementById('tournamentBadge').className = 'tournament-badge badge-running';
            document.getElementById('tournamentBadge').textContent = 'Iniciando...';
            
            showNotification('üéâ Torneio lotado! Preparando para iniciar...', 'success');
        }
    }
    
    // Atualizar interface do torneio
    function updateTournamentUI() {
        console.log('Atualizando UI do torneio:', currentTournament.name);
        
        // Esconder loading e mostrar conte√∫do
        document.getElementById('mainLoading').style.display = 'none';
        document.getElementById('mainContent').style.display = 'block';
        
        // Atualizar cabe√ßalho
        document.getElementById('tournamentTitle').textContent = currentTournament.name;
        document.getElementById('tournamentSubtitle').textContent = `Texas Hold'em - Torneio ${currentTournament.maxPlayers || 6} jogadores`;
        
        // Atualizar badge de status
        const badge = document.getElementById('tournamentBadge');
        let badgeClass = 'badge-registering';
        let badgeText = 'Inscri√ß√µes Abertas';
        
        if (currentTournament.status === 'running') {
            badgeClass = 'badge-running';
            badgeText = 'Em Andamento';
        } else if (currentTournament.status === 'starting') {
            badgeClass = 'badge-running';
            badgeText = 'Iniciando...';
        } else if (currentTournament.status === 'finished') {
            badgeClass = 'badge-finished';
            badgeText = 'Finalizado';
        }
        
        badge.className = `tournament-badge ${badgeClass}`;
        badge.textContent = badgeText;
        
        // Atualizar info de aguardo
        const playersCount = currentTournament.registeredPlayers || 0;
        const maxPlayers = currentTournament.maxPlayers || 6;
        document.getElementById('waitingValue').textContent = `${playersCount}/${maxPlayers}`;
        
        // Atualizar estat√≠sticas
        updateTournamentStats();
        
        // Atualizar estrutura de blinds
        updateBlindsTable();
        
        // Atualizar pr√™mios
        updatePrizesTable();
        
        // Atualizar regras
        updateRulesList();
        
        // Atualizar a√ß√£o principal
        updateMainAction();
        
        // Atualizar lista de jogadores
        updatePlayersList();
    }
    
    // Atualizar estat√≠sticas do torneio
    function updateTournamentStats() {
        const statsContainer = document.getElementById('tournamentStats');
        
        const prizePool = currentTournament.prizePool || (currentTournament.registeredPlayers || 0) * currentTournament.buyIn;
        
        const stats = [
            {
                icon: 'fas fa-users',
                value: `${currentTournament.registeredPlayers || 0}/${currentTournament.maxPlayers || 6}`,
                label: 'Jogadores'
            },
            {
                icon: 'fas fa-coins',
                value: currentTournament.buyIn || 100,
                label: 'Buy-in (Fichas)'
            },
            {
                icon: 'fas fa-layer-group',
                value: currentTournament.startingStack || 1500,
                label: 'Stack Inicial'
            },
            {
                icon: 'fas fa-trophy',
                value: prizePool,
                label: 'Pr√™mio Total'
            },
            {
                icon: 'fas fa-redo',
                value: currentTournament.rebuyAllowed ? 'Sim' : 'N√£o',
                label: 'Rebuy'
            },
            {
                icon: 'fas fa-plus-circle',
                value: currentTournament.addonAllowed ? 'Sim' : 'N√£o',
                label: 'Add-on'
            }
        ];
        
        statsContainer.innerHTML = stats.map(stat => `
            <div class="stat-card">
                <div class="stat-icon"><i class="${stat.icon}"></i></div>
                <div class="stat-value">${stat.value}</div>
                <div class="stat-label">${stat.label}</div>
            </div>
        `).join('');
    }
    
    // Atualizar tabela de blinds
    function updateBlindsTable() {
        const tableBody = document.querySelector('#blindsTable tbody');
        
        if (!currentTournament.blindStructure || currentTournament.blindStructure.length === 0) {
            tableBody.innerHTML = `<tr><td colspan="5" style="text-align: center;">Estrutura n√£o definida</td></tr>`;
            return;
        }
        
        let html = '';
        currentTournament.blindStructure.forEach((level, index) => {
            const isCurrent = currentTournament.currentLevel === level.level;
            const rowClass = isCurrent ? 'current-level' : '';
            
            html += `
                <tr class="${rowClass}">
                    <td>${level.level}</td>
                    <td>${level.smallBlind}</td>
                    <td>${level.bigBlind}</td>
                    <td>${level.ante || 0}</td>
                    <td>${level.duration || 10} min</td>
                </tr>
            `;
        });
        
        tableBody.innerHTML = html;
    }
    
    // Atualizar tabela de pr√™mios
    function updatePrizesTable() {
        const tableBody = document.querySelector('#prizesTable tbody');
        
        const prizePool = currentTournament.prizePool || (currentTournament.registeredPlayers || 0) * currentTournament.buyIn;
        const prizes = currentTournament.prizes || [
            { position: 1, percentage: 50 },
            { position: 2, percentage: 30 },
            { position: 3, percentage: 20 }
        ];
        
        let html = '';
        prizes.forEach(prize => {
            const amount = Math.round(prizePool * (prize.percentage / 100));
            html += `
                <tr>
                    <td>${prize.position}¬∫ Lugar</td>
                    <td>${prize.percentage}%</td>
                    <td class="prize-amount">${amount}</td>
                </tr>
            `;
        });
        
        tableBody.innerHTML = html;
    }
    
    // Atualizar lista de regras
    function updateRulesList() {
        const rulesList = document.getElementById('rulesList');
        
        const rules = [
            'Torneio de Texas Hold\'em',
            `Stack inicial: ${currentTournament.startingStack || 1500} fichas`,
            `M√°ximo: ${currentTournament.maxPlayers || 6} jogadores`,
            `Inicia quando atingir ${currentTournament.maxPlayers || 6} jogadores`,
            `Blinds aumentam a cada ${currentTournament.blindStructure?.[0]?.duration || 10} minutos`,
            currentTournament.rebuyAllowed ? `Rebuy permitido at√© ${currentTournament.addonTime || 30} minutos` : 'Rebuy n√£o permitido',
            currentTournament.addonAllowed ? `Add-on dispon√≠vel ap√≥s ${currentTournament.addonTime || 30} minutos` : 'Add-on n√£o dispon√≠vel',
            'Tempo por a√ß√£o: 30 segundos',
            'Time bank: 60 segundos acumulativos'
        ];
        
        rulesList.innerHTML = rules.map(rule => `<li>${rule}</li>`).join('');
    }
    
    // Atualizar a√ß√£o principal - COMPLETAMENTE CORRIGIDA E FUNCIONAL
    function updateMainAction() {
        const actionButton = document.getElementById('mainActionButton');
        const actionInfo = document.getElementById('actionInfo');
        
        if (!userData) {
            actionButton.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Carregando...';
            actionButton.className = 'btn-tournament btn-disabled';
            actionButton.disabled = true;
            actionInfo.textContent = 'Carregando informa√ß√µes do usu√°rio...';
            return;
        }
        
        // Verificar status do torneio
        if (currentTournament.status === 'finished') {
            actionButton.innerHTML = '<i class="fas fa-flag-checkered"></i> Torneio Finalizado';
            actionButton.className = 'btn-tournament btn-disabled';
            actionButton.disabled = true;
            actionInfo.textContent = 'Este torneio j√° foi finalizado.';
            return;
        }
        
        // Verificar se usu√°rio est√° inscrito
        if (isUserRegistered) {
            // VERIFICA√á√ÉO IMPORTANTE: Se torneio lotou (6 jogadores), pode entrar mesmo status sendo 'registering'
            const isTournamentFull = (currentTournament.registeredPlayers || 0) >= (currentTournament.maxPlayers || 6);
            
            if (currentTournament.status === 'running' || currentTournament.status === 'starting' || isTournamentFull) {
                // Torneio em andamento, iniciando ou LOTADO - entrar na mesa
                actionButton.innerHTML = '<i class="fas fa-play-circle"></i> Entrar na Mesa';
                actionButton.className = 'btn-tournament btn-enter';
                actionButton.onclick = () => enterTournament();
                
                if (isTournamentFull && currentTournament.status === 'registering') {
                    actionInfo.textContent = 'Torneio lotado! Clique para entrar e aguardar in√≠cio';
                } else {
                    actionInfo.textContent = 'Clique para entrar no torneio';
                }
            } else {
                // Torneio ainda registrando - aguardar in√≠cio
                actionButton.innerHTML = '<i class="fas fa-clock"></i> Aguardando Jogadores';
                actionButton.className = 'btn-tournament btn-registered';
                actionButton.disabled = true;
                const needed = (currentTournament.maxPlayers || 6) - (currentTournament.registeredPlayers || 0);
                actionInfo.textContent = `Faltam ${needed} jogadores para iniciar`;
            }
        } else {
            // Usu√°rio n√£o inscrito
            if (currentTournament.status === 'registering') {
                // Inscri√ß√µes abertas
                if (currentTournament.registeredPlayers >= currentTournament.maxPlayers) {
                    // Torneio lotado
                    actionButton.innerHTML = '<i class="fas fa-times-circle"></i> Torneio Lotado';
                    actionButton.className = 'btn-tournament btn-disabled';
                    actionButton.disabled = true;
                    actionInfo.textContent = 'Todas as vagas foram preenchidas.';
                } else if (userData.saldo < currentTournament.buyIn) {
                    // Saldo insuficiente
                    actionButton.innerHTML = '<i class="fas fa-wallet"></i> Saldo Insuficiente';
                    actionButton.className = 'btn-tournament btn-disabled';
                    actionButton.disabled = true;
                    actionInfo.textContent = `Voc√™ precisa de ${currentTournament.buyIn} fichas. Saldo atual: ${userData.saldo}`;
                } else {
                    // Pode se inscrever
                    actionButton.innerHTML = '<i class="fas fa-user-plus"></i> Inscrever-se';
                    actionButton.className = 'btn-tournament btn-register';
                    actionButton.onclick = () => registerForTournament();
                    actionInfo.textContent = `Clique para se inscrever (${currentTournament.buyIn} fichas)`;
                }
            } else if (currentTournament.status === 'running' || currentTournament.status === 'starting') {
                // Torneio em andamento - assistir
                actionButton.innerHTML = '<i class="fas fa-eye"></i> Assistir Torneio';
                actionButton.className = 'btn-tournament btn-watch';
                actionButton.onclick = () => watchTournament();
                actionInfo.textContent = 'Clique para assistir o torneio em andamento';
            } else {
                // Inscri√ß√µes encerradas
                actionButton.innerHTML = '<i class="fas fa-lock"></i> Inscri√ß√µes Encerradas';
                actionButton.className = 'btn-tournament btn-disabled';
                actionButton.disabled = true;
                actionInfo.textContent = 'As inscri√ß√µes para este torneio est√£o encerradas.';
            }
        }
    }
    
    // Atualizar lista de jogadores
    function updatePlayersList() {
        const playersList = document.getElementById('playersList');
        const playersCount = document.getElementById('playersCount');
        
        const players = currentTournament.players || [];
        const maxPlayers = currentTournament.maxPlayers || 6;
        playersCount.textContent = `${players.length}/${maxPlayers}`;
        
        if (players.length === 0) {
            playersList.innerHTML = '<div style="text-align: center; padding: 20px; color: var(--azul-claro);">Nenhum jogador inscrito ainda</div>';
            return;
        }
        
        let html = '';
        players.forEach(player => {
            const isYou = player.userId === currentUser?.uid;
            const playerClass = isYou ? 'player-item you' : 'player-item';
            
            html += `
                <div class="${playerClass}">
                    <div class="player-avatar">
                        <i class="fas fa-user"></i>
                    </div>
                    <div class="player-info-small">
                        <div class="player-name">${player.playerName || 'Jogador'}</div>
                        <div class="player-chips">${player.chips || currentTournament.startingStack} fichas</div>
                    </div>
                    ${isYou ? '<div class="player-position">VOC√ä</div>' : ''}
                </div>
            `;
        });
        
        // Adicionar slots vazios
        const emptySlots = maxPlayers - players.length;
        for (let i = 0; i < emptySlots; i++) {
            html += `
                <div class="player-item">
                    <div class="player-avatar" style="opacity: 0.5;">
                        <i class="fas fa-user-plus"></i>
                    </div>
                    <div class="player-info-small">
                        <div class="player-name" style="color: var(--azul-claro);">Vaga Dispon√≠vel</div>
                        <div class="player-chips" style="color: var(--azul-claro);">Aguardando...</div>
                    </div>
                </div>
            `;
        }
        
        playersList.innerHTML = html;
    }
    
    // Inscrever-se no torneio - CORRIGIDA
    async function registerForTournament() {
        console.log('Tentando inscrever-se no torneio:', currentTournament.id);
        
        if (!currentUser || !userData) {
            showNotification('‚ùå Voc√™ precisa estar logado para se inscrever', 'error');
            return;
        }
        
        try {
            // Buscar torneio novamente para garantir dados atualizados
            const tournamentDoc = await db.collection('tournaments').doc(currentTournament.id).get();
            if (!tournamentDoc.exists) {
                showNotification('‚ùå Torneio n√£o encontrado', 'error');
                return;
            }
            
            const tournament = tournamentDoc.data();
            
            // Verifica√ß√µes
            if (tournament.status !== 'registering') {
                showNotification('‚ùå Inscri√ß√µes encerradas para este torneio', 'error');
                return;
            }
            
            if (tournament.registeredPlayers >= tournament.maxPlayers) {
                showNotification('‚ùå Torneio lotado', 'error');
                return;
            }
            
            if (userData.saldo < tournament.buyIn) {
                showNotification(`‚ùå Saldo insuficiente. Necess√°rio: ${tournament.buyIn} fichas`, 'error');
                return;
            }
            
            // Verificar se j√° est√° inscrito (verifica√ß√£o local)
            if (isUserRegistered) {
                showNotification('‚ö†Ô∏è Voc√™ j√° est√° inscrito neste torneio', 'info');
                return;
            }
            
            // Armazenar torneio para confirma√ß√£o
            currentTournamentToRegister = tournament;
            currentTournamentToRegister.id = currentTournament.id;
            
            // Mostrar modal de confirma√ß√£o
            showRegistrationModal();
            
        } catch (error) {
            console.error('Erro ao verificar torneio:', error);
            showNotification('‚ùå Erro ao processar inscri√ß√£o: ' + error.message, 'error');
        }
    }
    
    // Mostrar modal de inscri√ß√£o
    function showRegistrationModal() {
        const modal = document.getElementById('confirmationModal');
        const modalTitle = document.getElementById('modalTitle');
        const modalBody = document.getElementById('modalBody');
        
        modalTitle.textContent = `Confirmar Inscri√ß√£o`;
        modalBody.innerHTML = `
            <p><strong>${currentTournamentToRegister.name}</strong></p>
            <br>
            <p>üìù <strong>Buy-in:</strong> ${currentTournamentToRegister.buyIn} fichas</p>
            <p>üí∞ <strong>Stack Inicial:</strong> ${currentTournamentToRegister.startingStack} fichas</p>
            <p>üë• <strong>Vagas:</strong> ${currentTournamentToRegister.registeredPlayers || 0}/${currentTournamentToRegister.maxPlayers}</p>
            <p>üèÜ <strong>Pr√™mio Total Estimado:</strong> ${((currentTournamentToRegister.registeredPlayers || 0) + 1) * currentTournamentToRegister.buyIn} fichas</p>
            <br>
            <p>Seu saldo atual: <strong>${userData.saldo} fichas</strong></p>
            <p>Saldo ap√≥s inscri√ß√£o: <strong>${userData.saldo - currentTournamentToRegister.buyIn} fichas</strong></p>
            <br>
            <p><strong>‚ö†Ô∏è IMPORTANTE:</strong> O torneio iniciar√° quando atingir ${currentTournamentToRegister.maxPlayers} jogadores.</p>
        `;
        
        modal.style.display = 'flex';
    }
    
    // Fechar modal
    function closeModal() {
        const modal = document.getElementById('confirmationModal');
        modal.style.display = 'none';
        currentTournamentToRegister = null;
    }
    
    // Confirmar inscri√ß√£o - CORRIGIDA
    async function confirmRegistration() {
        if (!currentTournamentToRegister) {
            showNotification('‚ùå Nenhum torneio selecionado', 'error');
            closeModal();
            return;
        }
        
        console.log('Confirmando inscri√ß√£o no torneio:', currentTournamentToRegister.name);
        
        const modal = document.getElementById('confirmationModal');
        modal.style.display = 'none';
        
        const actionButton = document.getElementById('mainActionButton');
        const originalHTML = actionButton.innerHTML;
        actionButton.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Processando...';
        actionButton.className = 'btn-tournament btn-disabled';
        actionButton.disabled = true;
        
        try {
            // 1. Deduzir buy-in do saldo do usu√°rio
            const newBalance = userData.saldo - currentTournamentToRegister.buyIn;
            
            // Atualizar saldo do usu√°rio no Firestore
            await db.collection('users').doc(currentUser.uid).update({
                saldo: newBalance,
                updatedAt: firebase.firestore.FieldValue.serverTimestamp()
            });
            
            // 2. Preparar dados do jogador (CORRIGIDO: usar timestamp manual)
            const playerData = {
                userId: currentUser.uid,
                playerName: userData.nickname || userData.nome || 'Jogador',
                playerId: userData.playerId,
                chips: currentTournamentToRegister.startingStack,
                position: 0,
                rebuyCount: 0,
                addonUsed: false,
                isActive: true,
                registeredAt: new Date().toISOString() // TIMESTAMP MANUAL - N√ÉO usar FieldValue aqui
            };
            
            // 3. Atualizar torneio no Firestore
            await db.collection('tournaments').doc(currentTournamentToRegister.id).update({
                registeredPlayers: firebase.firestore.FieldValue.increment(1),
                prizePool: firebase.firestore.FieldValue.increment(currentTournamentToRegister.buyIn),
                players: firebase.firestore.FieldValue.arrayUnion(playerData),
                updatedAt: firebase.firestore.FieldValue.serverTimestamp()
            });
            
            // 4. Atualizar dados locais do usu√°rio
            userData.saldo = newBalance;
            localStorage.setItem('keepPokerUser', JSON.stringify(userData));
            
            // 5. Atualizar UI
            document.getElementById('goldCount').textContent = newBalance;
            
            // 6. Marcar usu√°rio como inscrito localmente
            isUserRegistered = true;
            
            // 7. Notificar sucesso
            showNotification(`‚úÖ Inscri√ß√£o realizada com sucesso!`, 'success');
            
            // 8. Verificar se torneio lotou
            const newPlayersCount = (currentTournamentToRegister.registeredPlayers || 0) + 1;
            if (newPlayersCount >= currentTournamentToRegister.maxPlayers) {
                showNotification('üéâ Torneio lotado! Iniciando em breve...', 'success');
                
                // Atualizar status do torneio para "starting" (iniciando)
                await db.collection('tournaments').doc(currentTournamentToRegister.id).update({
                    status: 'starting',
                    updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                });
                
                // Mostrar contador de in√≠cio
                setTimeout(() => {
                    showNotification('‚è≥ Torneio iniciando em 30 segundos...', 'info');
                }, 1000);
            }
            
            // 9. Recarregar dados do torneio ap√≥s 1.5 segundos
            setTimeout(() => {
                if (tournamentUnsubscribe) tournamentUnsubscribe();
                loadTournamentData(currentTournamentToRegister.id);
                setupTournamentListener(currentTournamentToRegister.id);
            }, 1500);
            
        } catch (error) {
            console.error('Erro ao realizar inscri√ß√£o:', error);
            
            // Verificar tipo de erro
            if (error.code === 'failed-precondition') {
                showNotification('‚ùå Erro: campo "players" n√£o √© um array no Firestore', 'error');
                console.log('Solu√ß√£o: Verifique se o campo "players" no Firestore √© um array vazio []');
            } else if (error.message.includes('arrayUnion')) {
                showNotification('‚ùå Erro na estrutura do torneio. O campo "players" pode n√£o ser um array.', 'error');
            } else if (error.code === 'permission-denied') {
                showNotification('‚ùå Permiss√£o negada. Verifique as regras do Firestore.', 'error');
            } else {
                showNotification('‚ùå Erro ao realizar inscri√ß√£o: ' + error.message, 'error');
            }
            
            // Restaurar bot√£o
            actionButton.innerHTML = originalHTML;
            actionButton.disabled = false;
            updateMainAction();
        } finally {
            currentTournamentToRegister = null;
        }
    }
    
    // Entrar no torneio (quando em andamento)
    function enterTournament() {
        console.log('Entrando no torneio:', currentTournament.id);
        window.location.href = `mesa-torneio.html?tournamentId=${currentTournament.id}`;
    }
    
    // Assistir torneio (como espectador)
    function watchTournament() {
        console.log('Assistindo torneio:', currentTournament.id);
        window.location.href = `mesa-torneio.html?tournamentId=${currentTournament.id}&spectator=true`;
    }
    
    // Atualizar rel√≥gio
    function updateClock() {
        const now = new Date();
        const timeString = now.toLocaleTimeString('pt-BR', {
            hour: '2-digit',
            minute: '2-digit',
            second: '2-digit'
        });
        
        const currentTimeEl = document.getElementById('currentTime');
        if (currentTimeEl) {
            currentTimeEl.textContent = timeString;
        }
    }
    
    // Mostrar notifica√ß√£o
    function showNotification(message, type) {
        const notification = document.getElementById('notification');
        if (!notification) return;
        
        notification.textContent = message;
        notification.className = 'notification ' + type;
        notification.style.display = 'block';
        
        setTimeout(() => {
            notification.style.display = 'none';
        }, 4000);
    }
    
    // Limpar intervalo ao sair da p√°gina
    window.addEventListener('beforeunload', function() {
        if (tournamentUnsubscribe) {
            tournamentUnsubscribe();
        }
    });
</script>
</body>
</html>