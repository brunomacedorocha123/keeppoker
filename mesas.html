    <script>
        // Variáveis globais
        let currentUser = null;
        let userData = null;
        let tablesUnsubscribe = null;
        
        // Dados das mesas fixas da plataforma
        const PLATFORM_TABLES = [
            {
                id: "TEXAS_100",
                name: "Texas Hold'em - Iniciante",
                gameType: "texas-holdem",
                maxPlayers: 6,
                currentPlayers: 0,
                buyIn: 100,
                smallBlind: 1,
                bigBlind: 2,
                status: "waiting",
                createdBy: "PLATAFORMA",
                isPrivate: false,
                clubId: null,
                players: [],
                isPlatformTable: true,
                minLevel: 1
            },
            {
                id: "TEXAS_500",
                name: "Texas Hold'em - Intermediário",
                gameType: "texas-holdem",
                maxPlayers: 8,
                currentPlayers: 0,
                buyIn: 500,
                smallBlind: 5,
                bigBlind: 10,
                status: "waiting",
                createdBy: "PLATAFORMA",
                isPrivate: false,
                clubId: null,
                players: [],
                isPlatformTable: true,
                minLevel: 5
            },
            {
                id: "TEXAS_1000",
                name: "Texas Hold'em - Avançado",
                gameType: "texas-holdem",
                maxPlayers: 9,
                currentPlayers: 0,
                buyIn: 1000,
                smallBlind: 10,
                bigBlind: 20,
                status: "waiting",
                createdBy: "PLATAFORMA",
                isPrivate: false,
                clubId: null,
                players: [],
                isPlatformTable: true,
                minLevel: 10
            },
            {
                id: "OMAHA_200",
                name: "Omaha Hi-Lo",
                gameType: "omaha",
                maxPlayers: 6,
                currentPlayers: 0,
                buyIn: 200,
                smallBlind: 2,
                bigBlind: 4,
                status: "waiting",
                createdBy: "PLATAFORMA",
                isPrivate: false,
                clubId: null,
                players: [],
                isPlatformTable: true,
                minLevel: 3
            },
            {
                id: "STUD_300",
                name: "7 Card Stud",
                gameType: "7-card-stud",
                maxPlayers: 7,
                currentPlayers: 0,
                buyIn: 300,
                ante: 5,
                status: "waiting",
                createdBy: "PLATAFORMA",
                isPrivate: false,
                clubId: null,
                players: [],
                isPlatformTable: true,
                minLevel: 7
            }
        ];
        
        // Inicialização
        document.addEventListener('DOMContentLoaded', function() {
            // Verificar autenticação
            auth.onAuthStateChanged(async function(user) {
                if (user) {
                    currentUser = user;
                    await loadUserData();
                    initTablesPage();
                } else {
                    window.location.href = 'login.html';
                }
            });
            
            // Inicializar relógio
            updateClock();
            setInterval(updateClock, 1000);
            
            // Menu mobile
            const mobileMenuBtn = document.getElementById('mobileMenuBtn');
            const navMenu = document.getElementById('navMenu');
            if (mobileMenuBtn) {
                mobileMenuBtn.addEventListener('click', function() {
                    navMenu.classList.toggle('nav-open');
                    const icon = this.querySelector('i');
                    if (navMenu.classList.contains('nav-open')) {
                        icon.classList.remove('fa-bars');
                        icon.classList.add('fa-times');
                    } else {
                        icon.classList.remove('fa-times');
                        icon.classList.add('fa-bars');
                    }
                });
            }
            
            // Logout
            const logoutBtn = document.getElementById('logoutBtn');
            if (logoutBtn) {
                logoutBtn.addEventListener('click', function() {
                    auth.signOut().then(() => {
                        localStorage.removeItem('keepPokerUser');
                        window.location.href = 'index.html';
                    }).catch(error => {
                        console.error('Erro ao fazer logout:', error);
                        localStorage.removeItem('keepPokerUser');
                        window.location.href = 'index.html';
                    });
                });
            }
            
            // Depositar
            const depositBtn = document.getElementById('depositBtn');
            if (depositBtn) {
                depositBtn.addEventListener('click', function() {
                    showNotification('Funcionalidade de depósito em desenvolvimento', 'info');
                });
            }
            
            // Fechar menu mobile ao clicar em link
            const navLinks = document.querySelectorAll('.nav-link');
            navLinks.forEach(link => {
                link.addEventListener('click', () => {
                    if (window.innerWidth <= 992) {
                        navMenu.classList.remove('nav-open');
                        if (mobileMenuBtn) {
                            mobileMenuBtn.querySelector('i').classList.remove('fa-times');
                            mobileMenuBtn.querySelector('i').classList.add('fa-bars');
                        }
                    }
                });
            });
        });
        
        // Carregar dados do usuário
        async function loadUserData() {
            const user = localStorage.getItem('keepPokerUser');
            if (user) {
                userData = JSON.parse(user);
                // Atualizar header
                if (document.getElementById('playerId')) {
                    document.getElementById('playerId').textContent = userData.playerId || '-';
                    document.getElementById('diamondCount').textContent = userData.diamantes || '0';
                    document.getElementById('goldCount').textContent = userData.saldo || '0';
                }
            }
        }
        
        // Inicializar página de mesas
        function initTablesPage() {
            // Filtros
            document.getElementById('filterGameType').addEventListener('change', loadTables);
            document.getElementById('filterStatus').addEventListener('change', loadTables);
            document.getElementById('filterBuyIn').addEventListener('change', loadTables);
            document.getElementById('filterPlayers').addEventListener('change', loadTables);
            
            // Carregar mesas
            loadTables();
        }
        
        // Carregar mesas
        async function loadTables() {
            const tablesContainer = document.getElementById('tablesContainer');
            const emptyMessage = document.getElementById('emptyTables');
            
            // Mostrar loading
            tablesContainer.innerHTML = '<div class="loading"><i class="fas fa-spinner fa-spin"></i><p>Carregando mesas...</p></div>';
            emptyMessage.style.display = 'none';
            
            try {
                // Primeiro, tenta carregar do Firestore
                await loadTablesFromFirestore();
                
                // Se não houver mesas no Firestore, cria as mesas da plataforma
                const snapshot = await db.collection('tables')
                    .where('isPlatformTable', '==', true)
                    .limit(1)
                    .get();
                
                if (snapshot.empty) {
                    await createPlatformTables();
                    // Recarrega as mesas
                    await loadTablesFromFirestore();
                }
                
            } catch (error) {
                console.error('Erro ao carregar mesas:', error);
                showNotification('Erro ao carregar mesas', 'error');
            }
        }
        
        // Carregar mesas do Firestore
        async function loadTablesFromFirestore() {
            // Remover listener anterior se existir
            if (tablesUnsubscribe) {
                tablesUnsubscribe();
            }
            
            // Obter filtros
            const gameType = document.getElementById('filterGameType').value;
            const status = document.getElementById('filterStatus').value;
            const buyIn = document.getElementById('filterBuyIn').value;
            const players = document.getElementById('filterPlayers').value;
            
            // Construir query
            let query = db.collection('tables')
                .where('isPlatformTable', '==', true)
                .where('status', '!=', 'finished')
                .orderBy('buyIn', 'asc');
            
            // Aplicar filtros
            if (status !== 'all') {
                query = query.where('status', '==', status);
            }
            
            if (gameType !== 'all') {
                query = query.where('gameType', '==', gameType);
            }
            
            // Escutar mudanças em tempo real
            tablesUnsubscribe = query.onSnapshot((snapshot) => {
                const tables = [];
                snapshot.forEach((doc) => {
                    const table = doc.data();
                    table.id = doc.id;
                    
                    // Aplicar filtros adicionais
                    if (buyIn !== 'all' && table.buyIn > parseInt(buyIn)) {
                        return;
                    }
                    
                    if (players !== 'all' && table.maxPlayers !== parseInt(players)) {
                        return;
                    }
                    
                    tables.push(table);
                });
                
                renderTables(tables);
            }, (error) => {
                console.error('Erro ao escutar mesas:', error);
                // Se der erro, mostra mesas locais
                renderLocalTables();
            });
        }
        
        // Criar mesas da plataforma no Firestore
        async function createPlatformTables() {
            const batch = db.batch();
            
            for (const tableData of PLATFORM_TABLES) {
                const docRef = db.collection('tables').doc(tableData.id);
                const table = {
                    ...tableData,
                    createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                    updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                };
                batch.set(docRef, table);
            }
            
            try {
                await batch.commit();
                showNotification('Mesas da plataforma criadas com sucesso!', 'success');
            } catch (error) {
                console.error('Erro ao criar mesas da plataforma:', error);
            }
        }
        
        // Renderizar mesas locais (fallback)
        function renderLocalTables() {
            const tablesContainer = document.getElementById('tablesContainer');
            const emptyMessage = document.getElementById('emptyTables');
            
            // Filtrar mesas locais
            const gameType = document.getElementById('filterGameType').value;
            const status = document.getElementById('filterStatus').value;
            const buyIn = document.getElementById('filterBuyIn').value;
            const players = document.getElementById('filterPlayers').value;
            
            let tables = PLATFORM_TABLES;
            
            if (gameType !== 'all') {
                tables = tables.filter(table => table.gameType === gameType);
            }
            
            if (status !== 'all') {
                tables = tables.filter(table => table.status === status);
            }
            
            if (buyIn !== 'all') {
                tables = tables.filter(table => table.buyIn <= parseInt(buyIn));
            }
            
            if (players !== 'all') {
                tables = tables.filter(table => table.maxPlayers === parseInt(players));
            }
            
            if (tables.length === 0) {
                tablesContainer.innerHTML = '';
                emptyMessage.style.display = 'block';
                return;
            }
            
            renderTables(tables);
        }
        
        // Renderizar mesas na tela
        function renderTables(tables) {
            const tablesContainer = document.getElementById('tablesContainer');
            const emptyMessage = document.getElementById('emptyTables');
            
            if (tables.length === 0) {
                tablesContainer.innerHTML = '';
                emptyMessage.style.display = 'block';
                return;
            }
            
            emptyMessage.style.display = 'none';
            let tablesHTML = '';
            
            tables.forEach((table) => {
                // Verificar se usuário pode entrar
                const playerLevel = userData ? (userData.nivel || 1) : 1;
                const minLevel = table.minLevel || 1;
                const canEnter = table.status === 'waiting' && 
                                 table.currentPlayers < table.maxPlayers &&
                                 playerLevel >= minLevel &&
                                 (!userData || userData.saldo >= table.buyIn);
                
                // Verificar se usuário já está na mesa
                const isPlayerInTable = table.players?.some(p => p.userId === currentUser?.uid);
                const isPlaying = table.status === 'playing';
                
                // Gerar slots de jogadores
                let playersHTML = '';
                const totalSlots = table.maxPlayers;
                const occupiedSlots = table.players ? table.players.length : 0;
                
                for (let i = 0; i < totalSlots; i++) {
                    if (i < occupiedSlots) {
                        const player = table.players[i];
                        const isYou = player.userId === currentUser?.uid;
                        const chipCount = player.chips || table.buyIn;
                        
                        playersHTML += `
                            <div class="player-slot ${isYou ? 'you' : 'occupied'}">
                                ${isYou ? 'Você' : `J${i + 1}`}
                                <div class="player-chip">${chipCount}</div>
                            </div>`;
                    } else {
                        playersHTML += `<div class="player-slot empty">Vazio</div>`;
                    }
                }
                
                // Botão de ação
                let actionButton;
                if (isPlayerInTable && isPlaying) {
                    actionButton = `<button class="btn-table btn-watch" onclick="rejoinTable('${table.id}')">Retornar</button>`;
                } else if (isPlayerInTable) {
                    actionButton = `<button class="btn-table btn-enter" onclick="rejoinTable('${table.id}')">Retornar</button>`;
                } else if (canEnter) {
                    actionButton = `<button class="btn-table btn-enter" onclick="enterTable('${table.id}')">Entrar</button>`;
                } else if (isPlaying) {
                    actionButton = `<button class="btn-table btn-watch" onclick="viewTable('${table.id}')">Assistir</button>`;
                } else {
                    actionButton = `<button class="btn-table btn-full" disabled>${playerLevel < minLevel ? 'Nível Insuficiente' : 'Lotada'}</button>`;
                }
                
                // Determinar status da mesa
                let statusClass = 'status-waiting';
                let statusText = 'Aguardando';
                
                if (table.status === 'playing') {
                    statusClass = 'status-playing';
                    statusText = 'Em Andamento';
                } else if (table.currentPlayers >= table.maxPlayers) {
                    statusClass = 'status-full';
                    statusText = 'Lotada';
                }
                
                // Informações específicas por tipo de jogo
                let gameSpecificInfo = '';
                if (table.gameType === '7-card-stud') {
                    gameSpecificInfo = `
                        <div class="detail-row">
                            <span class="detail-label">Ante</span>
                            <span class="detail-value">${table.ante || 5}</span>
                        </div>`;
                } else {
                    gameSpecificInfo = `
                        <div class="detail-row">
                            <span class="detail-label">Blinds</span>
                            <span class="detail-value">${table.smallBlind}/${table.bigBlind}</span>
                        </div>`;
                }
                
                tablesHTML += `
                    <div class="table-card platform-table">
                        <div class="table-card-header">
                            <h3 class="table-name">${table.name}</h3>
                            <span class="table-status ${statusClass}">${statusText}</span>
                        </div>
                        
                        <div class="table-details">
                            <div class="detail-row">
                                <span class="detail-label">Tipo de Jogo</span>
                                <span class="detail-value">${getGameTypeName(table.gameType)}</span>
                            </div>
                            <div class="detail-row">
                                <span class="detail-label">Buy-in</span>
                                <span class="detail-value">${table.buyIn} fichas</span>
                            </div>
                            ${gameSpecificInfo}
                            <div class="detail-row">
                                <span class="detail-label">Nível Mín.</span>
                                <span class="detail-value">${table.minLevel || 1}</span>
                            </div>
                        </div>
                        
                        <div class="players-section">
                            <div class="players-title">
                                <i class="fas fa-users"></i>
                                <span>Jogadores (${table.currentPlayers || 0}/${table.maxPlayers})</span>
                            </div>
                            <div class="players-grid">
                                ${playersHTML}
                            </div>
                        </div>
                        
                        <div class="table-actions">
                            ${actionButton}
                            <button class="btn-table btn-view" onclick="showTableInfo('${table.id}')">Info</button>
                        </div>
                    </div>
                `;
            });
            
            tablesContainer.innerHTML = tablesHTML;
        }
        
        // Obter nome do tipo de jogo
        function getGameTypeName(gameType) {
            const names = {
                'texas-holdem': 'Texas Hold\'em',
                'omaha': 'Omaha',
                '7-card-stud': '7 Card Stud'
            };
            return names[gameType] || gameType;
        }
        
        // Entrar em uma mesa
        async function enterTable(tableId) {
            try {
                // Verificar se usuário está logado
                if (!currentUser || !userData) {
                    showNotification('Faça login para entrar em uma mesa', 'error');
                    return;
                }
                
                // Buscar dados da mesa
                const tableDoc = await db.collection('tables').doc(tableId).get();
                if (!tableDoc.exists) {
                    showNotification('Mesa não encontrada', 'error');
                    return;
                }
                
                const table = tableDoc.data();
                
                // Verificar nível do jogador
                const playerLevel = userData.nivel || 1;
                const minLevel = table.minLevel || 1;
                
                if (playerLevel < minLevel) {
                    showNotification(`Nível insuficiente! Requer nível ${minLevel}`, 'error');
                    return;
                }
                
                // Verificar se mesa está cheia
                if (table.currentPlayers >= table.maxPlayers) {
                    showNotification('Mesa está lotada', 'error');
                    return;
                }
                
                // Verificar se mesa está em andamento
                if (table.status === 'playing') {
                    showNotification('Mesa já está em andamento', 'error');
                    return;
                }
                
                // Verificar se usuário já está na mesa
                const isAlreadyInTable = table.players?.some(p => p.userId === currentUser.uid);
                if (isAlreadyInTable) {
                    showNotification('Você já está nesta mesa', 'info');
                    window.location.href = `mesa.html?tableId=${tableId}`;
                    return;
                }
                
                // Verificar saldo
                if (userData.saldo < table.buyIn) {
                    showNotification(`Saldo insuficiente. Você precisa de ${table.buyIn} fichas`, 'error');
                    return;
                }
                
                // Encontrar próxima posição disponível
                let position = 1;
                const occupiedPositions = table.players?.map(p => p.position) || [];
                while (occupiedPositions.includes(position)) {
                    position++;
                }
                
                // Adicionar jogador à mesa
                const newPlayer = {
                    userId: currentUser.uid,
                    playerId: userData.playerId,
                    playerName: userData.nome || 'Jogador',
                    position: position,
                    chips: table.buyIn,
                    status: 'waiting',
                    isOwner: false,
                    level: playerLevel
                };
                
                // Atualizar mesa
                await db.collection('tables').doc(tableId).update({
                    currentPlayers: firebase.firestore.FieldValue.increment(1),
                    players: firebase.firestore.FieldValue.arrayUnion(newPlayer)
                });
                
                // Subtrair buy-in do saldo
                await db.collection('users').doc(currentUser.uid).update({
                    saldo: firebase.firestore.FieldValue.increment(-table.buyIn)
                });
                
                // Atualizar localmente
                userData.saldo -= table.buyIn;
                localStorage.setItem('keepPokerUser', JSON.stringify(userData));
                document.getElementById('goldCount').textContent = userData.saldo;
                
                showNotification(`Entrou na mesa "${table.name}"!`, 'success');
                
                // Redirecionar para a mesa
                setTimeout(() => {
                    window.location.href = `mesa.html?tableId=${tableId}`;
                }, 1000);
                
            } catch (error) {
                console.error('Erro ao entrar na mesa:', error);
                showNotification('Erro ao entrar na mesa', 'error');
            }
        }
        
        // Retornar à mesa
        async function rejoinTable(tableId) {
            try {
                // Buscar dados da mesa
                const tableDoc = await db.collection('tables').doc(tableId).get();
                if (!tableDoc.exists) {
                    showNotification('Mesa não encontrada', 'error');
                    return;
                }
                
                const table = tableDoc.data();
                
                // Verificar se usuário está na mesa
                const isInTable = table.players?.some(p => p.userId === currentUser?.uid);
                if (!isInTable) {
                    showNotification('Você não está nesta mesa', 'error');
                    return;
                }
                
                // Redirecionar para a mesa
                window.location.href = `mesa.html?tableId=${tableId}`;
                
            } catch (error) {
                console.error('Erro ao retornar à mesa:', error);
                showNotification('Erro ao retornar à mesa', 'error');
            }
        }
        
        // Visualizar mesa (assistir)
        async function viewTable(tableId) {
            try {
                // Buscar dados da mesa
                const tableDoc = await db.collection('tables').doc(tableId).get();
                if (!tableDoc.exists) {
                    showNotification('Mesa não encontrada', 'error');
                    return;
                }
                
                const table = tableDoc.data();
                
                // Verificar se mesa está em andamento
                if (table.status !== 'playing') {
                    showNotification('Esta mesa não está em andamento', 'info');
                    return;
                }
                
                // Redirecionar como espectador
                window.location.href = `mesa.html?tableId=${tableId}&spectator=true`;
                
            } catch (error) {
                console.error('Erro ao assistir mesa:', error);
                showNotification('Erro ao assistir mesa', 'error');
            }
        }
        
        // Mostrar informações da mesa
        async function showTableInfo(tableId) {
            try {
                // Buscar dados da mesa
                const tableDoc = await db.collection('tables').doc(tableId).get();
                if (!tableDoc.exists) {
                    showNotification('Mesa não encontrada', 'error');
                    return;
                }
                
                const table = tableDoc.data();
                
                // Criar mensagem informativa
                let infoMessage = `
                    <strong>${table.name}</strong><br>
                    Tipo: ${getGameTypeName(table.gameType)}<br>
                    Buy-in: ${table.buyIn} fichas<br>
                    Jogadores: ${table.currentPlayers}/${table.maxPlayers}<br>
                    Nível mínimo: ${table.minLevel || 1}<br>
                    <br>
                    <strong>Regras:</strong><br>`;
                
                if (table.gameType === 'texas-holdem' || table.gameType === 'omaha') {
                    infoMessage += `- Blinds: ${table.smallBlind}/${table.bigBlind}<br>`;
                    infoMessage += `- Tempo por ação: 30 segundos<br>`;
                } else if (table.gameType === '7-card-stud') {
                    infoMessage += `- Ante: ${table.ante || 5}<br>`;
                    infoMessage += `- Bring-in: ${table.bringIn || table.ante * 2 || 10}<br>`;
                }
                
                infoMessage += `- Rebuy: Permitido até o nível 3<br>`;
                infoMessage += `- Time bank: 60 segundos total<br>`;
                
                // Mostrar como alerta temporário
                const tempDiv = document.createElement('div');
                tempDiv.innerHTML = infoMessage;
                tempDiv.style.cssText = `
                    background: var(--azul-medio);
                    color: var(--cinza-claro);
                    padding: 20px;
                    border-radius: 10px;
                    border: 2px solid var(--dourado);
                    max-width: 400px;
                    font-size: 14px;
                `;
                
                // Criar overlay
                const overlay = document.createElement('div');
                overlay.style.cssText = `
                    position: fixed;
                    top: 0;
                    left: 0;
                    right: 0;
                    bottom: 0;
                    background: rgba(0,0,0,0.8);
                    display: flex;
                    justify-content: center;
                    align-items: center;
                    z-index: 10001;
                `;
                
                overlay.appendChild(tempDiv);
                document.body.appendChild(overlay);
                
                // Fechar ao clicar
                overlay.addEventListener('click', () => {
                    document.body.removeChild(overlay);
                });
                
            } catch (error) {
                console.error('Erro ao buscar informações:', error);
                showNotification('Erro ao carregar informações', 'error');
            }
        }
        
        // Atualizar relógio
        function updateClock() {
            const now = new Date();
            const timeString = now.toLocaleTimeString('pt-BR', {
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            });
            document.getElementById('currentTime').textContent = timeString;
        }
        
        // Mostrar notificação
        function showNotification(message, type) {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = 'notification ' + type;
            notification.style.display = 'block';
            
            setTimeout(() => {
                notification.style.display = 'none';
            }, 4000);
        }
    </script>
</body>
</html>