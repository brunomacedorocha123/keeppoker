<!DOCTYPE html>
<html lang="pt-br">
<head>
 <meta charset="UTF-8">
 <meta name="viewport" content="width=device-width, initial-scale=1.0">
 <title>Mesa de Torneio | KeepPoker</title>
 
 <!-- Firebase -->
 <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
 <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
 <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
 
 <script>
   // Firebase Configuration
   const firebaseConfig = {
     apiKey: "AIzaSyBIBucZSzN671VgJQHGIiepHNUqxbqNKAQ",
     authDomain: "keeppoker-b4173.firebaseapp.com",
     projectId: "keeppoker-b4173",
     storageBucket: "keeppoker-b4173.firebasestorage.app",
     messagingSenderId: "436464592434",
     appId: "1:436464592434:web:c5a1e0c10e10acbc14fe2b"
   };
   
   // Initialize Firebase
   firebase.initializeApp(firebaseConfig);
   const auth = firebase.auth();
   const db = firebase.firestore();
 </script>
 
 <!-- Poker Engine (ARQUIVO SEPARADO) -->
 <script src="poker-engine.js"></script>
 
 <style>
 /* ===== RESET ===== */
 * {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
 }


 /* ===== BASE ===== */
 body {
  background: #0a1520;
  color: white;
  font-family: 'Segoe UI', sans-serif;
  height: 100vh;
  overflow: hidden;
 }


 /* ===== CABE√áALHO ===== */
 .header {
  height: 60px;
  background: rgba(13, 27, 42, 0.9);
  border-bottom: 2px solid #d4af37;
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 0 20px;
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  z-index: 100;
 }


 .tournament-info {
  font-size: 1.1em;
  color: #d4af37;
  font-weight: bold;
 }


 .game-stats {
  display: flex;
  gap: 20px;
 }


 .stat {
  background: rgba(212, 175, 55, 0.15);
  padding: 6px 12px;
  border-radius: 12px;
  border: 1px solid rgba(212, 175, 55, 0.3);
  font-weight: bold;
 }

 /* ===== MESA ===== */
 .table-container {
  position: absolute;
  top: 45%;
  left: 50%;
  transform: translate(-50%, -50%);
  width: 70%;
  height: 55%;
  z-index: 1;
 }


 /* MESA FORMATO SALSICHA */
 .poker-table {
  width: 100%;
  height: 100%;
  background: #0a5c36;
  border: 15px solid #8B4513;
  border-radius: 50% / 40%; /* Formato salsicha */
  box-shadow:
   inset 0 0 40px rgba(0, 0, 0, 0.6),
   0 0 30px rgba(0, 0, 0, 0.7);
  position: relative;
 }


 /* √ÅREA CENTRAL DA MESA */
 .table-center {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  width: 40%;
  height: 40%;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: 15px;
 }


 /* CARTAS COMUNIT√ÅRIAS */
 .community-cards {
  display: flex;
  gap: 8px;
 }


 .card-placeholder {
  width: 50px;
  height: 70px;
  background: white;
  border-radius: 5px;
  border: 2px solid #333;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  font-size: 1.2em;
  box-shadow: 0 2px 5px rgba(0,0,0,0.3);
  color: #2c3e50;
 }

 /* Carta virada (back) */
 .card-back {
  background: linear-gradient(45deg, #1a237e, #283593);
  color: white;
  border: 2px solid #3949ab;
 }

 /* POT */
 .pot {
  color: #d4af37;
  font-size: 1.4em;
  font-weight: bold;
 }


 /* ===== AVATARS ===== */
 .avatar-container {
  position: absolute;
  display: flex;
  flex-direction: column;
  align-items: center;
  z-index: 10;
 }


 /* AVATAR CIRCULAR */
 .avatar {
  width: 70px;
  height: 70px;
  border-radius: 50%;
  background: linear-gradient(135deg, #415a77, #1b263b);
  border: 3px solid #d4af37;
  display: flex;
  align-items: center;
  justify-content: center;
  color: white;
  font-size: 1.4em;
  margin-bottom: 5px;
  box-shadow: 0 5px 15px rgba(0, 0, 0, 0.4);
  position: relative;
  overflow: hidden;
 }

 .avatar img {
  width: 100%;
  height: 100%;
  object-fit: cover;
  border-radius: 50%;
 }

 /* CHIPS DO JOGADOR */
 .player-chips {
  background: rgba(0, 0, 0, 0.7);
  color: #ffd700;
  padding: 4px 8px;
  border-radius: 10px;
  font-size: 0.9em;
  font-weight: bold;
  margin-top: 5px;
  min-width: 80px;
  text-align: center;
 }

 /* JOGADOR ATUAL (vez) */
 .current-turn .avatar {
  border-color: #00ff00;
  box-shadow: 0 0 15px rgba(0, 255, 0, 0.5);
 }

 /* APOSTA DO JOGADOR */
 .player-bet {
  position: absolute;
  top: -15px;
  background: rgba(212, 175, 55, 0.9);
  color: #000;
  padding: 3px 8px;
  border-radius: 10px;
  font-weight: bold;
  font-size: 0.8em;
  white-space: nowrap;
 }

 /* FOLDED/INATIVO */
 .player-folded .avatar {
  opacity: 0.5;
  border-color: #666;
 }

 /* INFO DO JOGADOR (S√ì APARECE PARA VOC√ä) */
 .player-info {
  background: rgba(13, 27, 42, 0.95);
  padding: 8px 12px;
  border-radius: 8px;
  border: 1px solid rgba(212, 175, 55, 0.3);
  text-align: center;
  min-width: 100px;
  font-size: 0.9em;
  display: none;
 }


 /* ===== POSICIONAMENTO DOS AVATARS ===== */


 /* POSI√á√ÉO 1: TOPO (VOC√ä) - MAIS PRA CIMA AGORA */
 .pos-1 {
  top: -5%; /* MAIS PRA CIMA (antes -1%) */
  left: 50%;
  transform: translateX(-50%);
 }


 /* POSI√á√ÉO 2: DIREITA SUPERIOR - MANT√âM */
 .pos-2 {
  top: 16.5%;
  right: 1.5%;
 }


 /* POSI√á√ÉO 3: DIREITA INFERIOR - MANT√âM */
 .pos-3 {
  bottom: 16.5%;
  right: 1.5%;
 }


 /* POSI√á√ÉO 4: BAIXO CENTRO - MANT√âM */
 .pos-4 {
  bottom: 1.5%;
  left: 50%;
  transform: translateX(-50%);
 }


 /* POSI√á√ÉO 5: ESQUERDA INFERIOR - MANT√âM */
 .pos-5 {
  bottom: 16.5%;
  left: 1.5%;
 }


 /* POSI√á√ÉO 6: ESQUERDA SUPERIOR - MANT√âM */
 .pos-6 {
  top: 16.5%;
  left: 1.5%;
 }


 /* AVATAR DO JOGADOR (VOC√ä) */
 .player-you .avatar {
  border-color: #3498db;
  box-shadow: 0 0 15px rgba(52, 152, 219, 0.5);
 }


 .player-you .player-info {
  display: block;
 }


 /* ===== CONTROLES ===== */
 .controls {
  position: fixed;
  bottom: 10px;
  left: 50%;
  transform: translateX(-50%);
  background: rgba(13, 27, 42, 0.95);
  padding: 15px;
  border-radius: 12px;
  border: 2px solid #d4af37;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 12px;
  z-index: 100;
  min-width: 400px;
  box-shadow: 0 4px 15px rgba(0, 0, 0, 0.4);
 }


 /* SUAS CARTAS (FORA DA MESA) */
 .your-cards {
  display: flex;
  gap: 10px;
 }


 .your-card {
  width: 60px;
  height: 84px;
  background: white;
  border-radius: 6px;
  border: 2px solid #000;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 1.5em;
  font-weight: bold;
  color: #000;
  box-shadow: 0 3px 10px rgba(0,0,0,0.3);
 }


 /* BOT√ïES DE A√á√ÉO */
 .action-buttons {
  display: flex;
  gap: 8px;
 }


 .action-btn {
  padding: 12px 20px;
  border: none;
  border-radius: 8px;
  font-weight: bold;
  cursor: pointer;
  min-width: 80px;
  font-size: 0.9em;
  transition: all 0.3s;
 }


 .btn-fold { background: #e74c3c; color: white; }
 .btn-check { background: #3498db; color: white; }
 .btn-call { background: #2ecc71; color: white; }
 .btn-raise { background: #9b59b6; color: white; }
 .btn-allin { background: #e67e22; color: white; }

 .action-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 8px rgba(0,0,0,0.3);
 }

 .action-btn:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
 }

 /* CONTROLE DE APOSTA */
 .bet-controls {
  display: flex;
  gap: 10px;
  align-items: center;
  margin-top: 10px;
  display: none;
 }

 .bet-slider {
  flex: 1;
  height: 8px;
  background: rgba(255,255,255,0.1);
  border-radius: 4px;
  outline: none;
 }

 .bet-amount {
  background: rgba(212, 175, 55, 0.2);
  padding: 8px 15px;
  border-radius: 8px;
  font-weight: bold;
  color: #ffd700;
  min-width: 80px;
  text-align: center;
 }

 /* TIMER DE A√á√ÉO */
 .action-timer {
  width: 100%;
  height: 6px;
  background: rgba(255,255,255,0.1);
  border-radius: 3px;
  margin-top: 10px;
  overflow: hidden;
  display: none;
 }

 .timer-bar {
  height: 100%;
  background: linear-gradient(90deg, #2ecc71, #e67e22, #e74c3c);
  width: 100%;
  transition: width 1s linear;
 }

 /* MENSAGEM DE STATUS */
 .status-message {
  position: fixed;
  top: 70px;
  left: 50%;
  transform: translateX(-50%);
  background: rgba(0,0,0,0.8);
  padding: 10px 20px;
  border-radius: 20px;
  border: 1px solid #d4af37;
  z-index: 1000;
  font-weight: bold;
  display: none;
 }

 /* ===== RESPONSIVIDADE ===== */
 @media (max-width: 768px) {
  .table-container {
   width: 85%;
   height: 50%;
   top: 44%;
  }

  .avatar {
   width: 50px;
   height: 50px;
   font-size: 1.2em;
  }

  /* POSI√á√ÉO 1 MAIS PRA CIMA NO MOBILE */
  .pos-1 { top: -8%; } /* MAIS PRA CIMA (antes -2%) */

  /* OS OUTROS 5 MANT√äM */
  .pos-2, .pos-6 { top: 14.5%; }
  .pos-3, .pos-5 { bottom: 14.5%; }
  .pos-2, .pos-3 { right: 1%; }
  .pos-4 { bottom: 1%; left: 50%; transform: translateX(-50%); }
  .pos-5, .pos-6 { left: 1%; }

  .controls {
   min-width: 90%;
   padding: 12px;
   bottom: 8px;
  }

  .action-btn {
   padding: 8px 15px;
   min-width: 70px;
   font-size: 0.9em;
  }

  .your-card {
   width: 40px;
   height: 56px;
   font-size: 1.1em;
  }
 }


 @media (max-width: 480px) {
  .header {
   padding: 0 10px;
  }

  .game-stats {
   gap: 10px;
  }

  .stat {
   padding: 4px 8px;
   font-size: 0.9em;
  }

  .avatar {
   width: 40px;
   height: 40px;
   font-size: 1em;
  }

  .table-container {
   top: 43%;
  }

  /* POSI√á√ÉO 1 AINDA MAIS PRA CIMA NO MOBILE PEQUENO */
  .pos-1 { top: -12%; } /* MAIS PRA CIMA (antes -3%) */

  /* OS OUTROS 5 MANT√äM */
  .pos-2, .pos-6 { top: 12.5%; }
  .pos-3, .pos-5 { bottom: 12.5%; }
  .pos-2, .pos-3 { right: 0.5%; }
  .pos-4 { bottom: 0.5%; left: 50%; transform: translateX(-50%); }
  .pos-5, .pos-6 { left: 0.5%; }

  .controls {
   bottom: 6px;
  }

  .your-card {
   width: 40px;
   height: 56px;
   font-size: 1.1em;
  }

  .action-btn {
   padding: 7px 12px;
   min-width: 60px;
   font-size: 0.8em;
  }
 }
 </style>
</head>
<body>
 <!-- CABE√áALHO -->
 <div class="header">
  <div class="tournament-info" id="tournamentName">Torneio</div>
  <div class="game-stats">
   <div class="stat" id="blinds">100/200</div>
   <div class="stat" id="pot">Pote: 0</div>
   <div class="stat" id="playersCount">1/6</div>
  </div>
 </div>

 <!-- MENSAGEM DE STATUS -->
 <div class="status-message" id="statusMessage"></div>

 <!-- CONTAINER DA MESA -->
 <div class="table-container">
  <!-- MESA -->
  <div class="poker-table">
   <!-- √ÅREA CENTRAL -->
   <div class="table-center">
    <div class="community-cards" id="communityCards">
     <div class="card-placeholder"></div>
     <div class="card-placeholder"></div>
     <div class="card-placeholder"></div>
     <div class="card-placeholder"></div>
     <div class="card-placeholder"></div>
    </div>
    <div class="pot" id="potAmount">0</div>
   </div>
  </div>
  
  <!-- AVATARS (SER√ÉO PREENCHIDOS DINAMICAMENTE) -->
  <div id="playersContainer">
   <!-- Os 6 avatares ser√£o gerados aqui -->
  </div>
 </div>

 <!-- CONTROLES (FORA DA MESA) -->
 <div class="controls" id="playerControls">
  <!-- SUAS CARTAS -->
  <div class="your-cards">
   <div class="your-card" id="card1">?</div>
   <div class="your-card" id="card2">?</div>
  </div>
  
  <!-- BOT√ïES DE A√á√ÉO -->
  <div class="action-buttons" id="actionButtons">
   <button class="action-btn btn-fold" onclick="playerAction('fold')" id="btnFold">Fold</button>
   <button class="action-btn btn-check" onclick="playerAction('check')" id="btnCheck">Check</button>
   <button class="action-btn btn-call" onclick="playerAction('call')" id="btnCall">Call</button>
   <button class="action-btn btn-raise" onclick="showRaiseControls()" id="btnRaise">Raise</button>
   <button class="action-btn btn-allin" onclick="playerAction('allin')" id="btnAllin">All-in</button>
  </div>
  
  <!-- CONTROLE DE APOSTA (aparece quando clica em Raise) -->
  <div class="bet-controls" id="raiseControls">
   <input type="range" min="0" max="100" value="0" class="bet-slider" id="betSlider" oninput="updateBetAmount()">
   <div class="bet-amount" id="betAmount">0</div>
   <button class="action-btn btn-raise" onclick="confirmRaise()">Confirmar</button>
   <button class="action-btn btn-fold" onclick="hideRaiseControls()">Cancelar</button>
  </div>
  
  <!-- TIMER DE A√á√ÉO -->
  <div class="action-timer" id="actionTimerContainer">
   <div class="timer-bar" id="actionTimerBar"></div>
  </div>
 </div>

 <!-- SCRIPT PRINCIPAL -->
 <script>
  // =============================================
  // VARI√ÅVEIS GLOBAIS
  // =============================================
  let tournamentId = null;
  let tournamentData = null;
  let currentUser = null;
  let userData = null;
  let pokerGame = null;
  let realtimeListener = null;
  let actionTimerInterval = null;
  let timeLeft = 30;
  let currentPlayerPosition = -1;

  // =============================================
  // INICIALIZA√á√ÉO DA MESA
  // =============================================
  document.addEventListener('DOMContentLoaded', function() {
   console.log('üéÆ Inicializando mesa de poker...');
   
   // 1. Obter ID do torneio da URL
   const urlParams = new URLSearchParams(window.location.search);
   tournamentId = urlParams.get('tournamentId');
   
   if (!tournamentId) {
    alert('Torneio n√£o especificado!');
    window.location.href = 'torneios.html';
    return;
   }
   
   console.log(`üéØ Torneio ID: ${tournamentId}`);
   
   // 2. Verificar autentica√ß√£o
   auth.onAuthStateChanged(async (user) => {
    if (!user) {
     console.log('üë§ Usu√°rio n√£o autenticado');
     window.location.href = 'login.html';
     return;
    }
    
    currentUser = user;
    console.log(`‚úÖ Usu√°rio autenticado: ${user.uid}`);
    
    // 3. Carregar dados do usu√°rio
    await loadUserData();
    
    // 4. Carregar dados do torneio
    await loadTournamentData();
    
    // 5. Verificar se usu√°rio est√° no torneio
    if (!isUserInTournament()) {
     showNotification('‚ùå Voc√™ n√£o est√° inscrito neste torneio', 'error');
     setTimeout(() => {
      window.location.href = 'torneios.html';
     }, 2000);
     return;
    }
    
    // 6. Inicializar Poker Engine
    initializePokerGame();
    
    // 7. Configurar listener em tempo real
    setupRealtimeListener();
    
    // 8. Configurar controles
    setupControls();
   });
  });

  // =============================================
  // FUN√á√ïES PRINCIPAIS
  // =============================================
  
  // 1. Carregar dados do usu√°rio
  async function loadUserData() {
   try {
    const userDoc = await db.collection('users').doc(currentUser.uid).get();
    if (userDoc.exists) {
     userData = userDoc.data();
     console.log('üìä Dados do usu√°rio carregados:', userData.nickname);
    }
   } catch (error) {
    console.error('‚ùå Erro ao carregar dados do usu√°rio:', error);
   }
  }
  
  // 2. Carregar dados do torneio
  async function loadTournamentData() {
   try {
    const tournamentDoc = await db.collection('tournaments').doc(tournamentId).get();
    if (!tournamentDoc.exists) {
     throw new Error('Torneio n√£o encontrado');
    }
    
    tournamentData = tournamentDoc.data();
    tournamentData.id = tournamentId;
    
    console.log('üé≤ Dados do torneio:', tournamentData.name);
    console.log('üë• Jogadores inscritos:', tournamentData.players?.length || 0);
    
    // Atualizar header
    document.getElementById('tournamentName').textContent = tournamentData.name;
    document.getElementById('playersCount').textContent = 
     `${tournamentData.players?.length || 1}/${tournamentData.maxPlayers || 6}`;
    
   } catch (error) {
    console.error('‚ùå Erro ao carregar torneio:', error);
    showNotification('Erro ao carregar torneio', 'error');
   }
  }
  
  // 3. Verificar se usu√°rio est√° no torneio
  function isUserInTournament() {
   if (!tournamentData.players) return false;
   return tournamentData.players.some(p => p.userId === currentUser.uid);
  }
  
  // 4. Inicializar Poker Engine
  function initializePokerGame() {
   console.log('üé¥ Inicializando Poker Engine...');
   
   // Preparar jogadores (dados REAIS do Firestore)
   const players = tournamentData.players.map((player, index) => ({
    userId: player.userId,
    nickname: player.nickname || player.playerName || `Jogador ${index + 1}`,
    chips: player.chips || tournamentData.startingStack || 1500,
    position: index,
    isActive: true,
    avatarUrl: player.avatarUrl || ''
   }));
   
   // Encontrar posi√ß√£o do usu√°rio atual
   currentPlayerPosition = players.findIndex(p => p.userId === currentUser.uid);
   
   // Criar inst√¢ncia do jogo
   if (window.PokerEngine && window.PokerEngine.PokerGameEngine) {
    pokerGame = new window.PokerEngine.PokerGameEngine(tournamentId);
    pokerGame.initialize(players);
    
    console.log('‚úÖ Poker Engine inicializado');
    console.log(`üéÆ Voc√™ est√° na posi√ß√£o: ${currentPlayerPosition + 1}`);
    
    // Renderizar jogadores
    renderPlayers(players);
    
    // Iniciar jogo se tiver 2+ jogadores
    if (players.length >= 2) {
     startPokerHand();
    } else {
     showNotification('‚è≥ Aguardando mais jogadores...', 'info');
    }
    
   } else {
    console.error('‚ùå Poker Engine n√£o encontrado!');
    showNotification('Erro: Poker Engine n√£o carregado', 'error');
   }
  }
  
  // 5. Renderizar jogadores REAIS
  function renderPlayers(players) {
   const container = document.getElementById('playersContainer');
   container.innerHTML = '';
   
   // Posi√ß√µes pr√©-definidas para 6 jogadores
   const positions = ['pos-1', 'pos-2', 'pos-6', 'pos-3', 'pos-5', 'pos-4'];
   
   players.forEach((player, index) => {
    const positionClass = positions[index] || 'pos-1';
    const isYou = player.userId === currentUser.uid;
    const playerClass = isYou ? 'avatar-container player-you' : 'avatar-container';
    
    const avatarHTML = player.avatarUrl 
     ? `<img src="${player.avatarUrl}" alt="${player.nickname}">`
     : `<i class="fas fa-user"></i>`;
    
    const playerHTML = `
     <div class="${playerClass} ${positionClass}" data-user-id="${player.userId}">
      <div class="avatar" id="avatar-${player.userId}">
       ${avatarHTML}
      </div>
      <div class="player-chips" id="chips-${player.userId}">
       ${player.nickname}<br>${player.chips}
      </div>
      ${isYou ? `
       <div class="player-info">
        <div>Voc√™</div>
        <div>${player.chips}</div>
       </div>
      ` : ''}
     </div>
    `;
    
    container.innerHTML += playerHTML;
   });
  }
  
  // 6. Iniciar m√£o de poker
  async function startPokerHand() {
   if (!pokerGame) return;
   
   try {
    console.log('üÉè Iniciando nova m√£o...');
    showNotification('Nova m√£o iniciada!', 'info');
    
    const handResult = await pokerGame.startHand();
    
    // Atualizar cartas comunit√°rias (se houver)
    if (handResult.communityCards && handResult.communityCards.length > 0) {
     updateCommunityCards(handResult.communityCards);
    }
    
    // Atualizar pot
    updatePot(handResult.pot);
    
    // Atualizar blinds
    updateBlinds(handResult.blinds);
    
    // Mostrar cartas do jogador (se for a vez dele)
    showPlayerCards();
    
    // Verificar se √© a vez do jogador
    checkPlayerTurn();
    
   } catch (error) {
    console.error('‚ùå Erro ao iniciar m√£o:', error);
    showNotification('Erro ao iniciar m√£o: ' + error.message, 'error');
   }
  }
  
  // 7. Configurar listener em tempo real
  function setupRealtimeListener() {
   console.log('üëÇ Configurando listener em tempo real...');
   
   realtimeListener = db.collection('tournaments').doc(tournamentId)
    .onSnapshot((doc) => {
     if (doc.exists) {
      const newData = doc.data();
      
      // Atualizar dados do torneio
      tournamentData = newData;
      
      // Atualizar contador de jogadores
      document.getElementById('playersCount').textContent = 
       `${newData.players?.length || 1}/${newData.maxPlayers || 6}`;
      
      // Atualizar cartas comunit√°rias se mudaram
      if (newData.communityCards && JSON.stringify(newData.communityCards) !== 
          JSON.stringify(tournamentData.communityCards)) {
       updateCommunityCards(newData.communityCards);
      }
      
      // Atualizar pot se mudou
      if (newData.pot !== tournamentData.pot) {
       updatePot(newData.pot);
      }
      
     }
    }, (error) => {
     console.error('‚ùå Erro no listener:', error);
    });
  }
  
  // =============================================
  // ATUALIZA√á√ÉO DA INTERFACE
  // =============================================
  
  function updateCommunityCards(cards) {
   const communityContainer = document.getElementById('communityCards');
   const cardElements = communityContainer.querySelectorAll('.card-placeholder');
   
   cards.forEach((card, index) => {
    if (cardElements[index]) {
     if (typeof card === 'string') {
      cardElements[index].textContent = card;
      cardElements[index].style.color = card.includes('‚ô•') || card.includes('‚ô¶') ? '#e74c3c' : '#2c3e50';
     } else if (card.suit && card.rank) {
      const cardObj = new window.PokerEngine.PokerCard(card.suit, card.rank);
      cardElements[index].textContent = cardObj.toString();
      cardElements[index].style.color = cardObj.color === 'red' ? '#e74c3c' : '#2c3e50';
     }
    }
   });
  }
  
  function updatePot(potAmount) {
   document.getElementById('pot').textContent = `Pote: ${potAmount}`;
   document.getElementById('potAmount').textContent = potAmount;
  }
  
  function updateBlinds(blinds) {
   if (blinds && blinds.smallBlind && blinds.bigBlind) {
    document.getElementById('blinds').textContent = `${blinds.smallBlind}/${blinds.bigBlind}`;
   }
  }
  
  function showPlayerCards() {
   if (!pokerGame || !currentUser) return;
   
   const playerInfo = pokerGame.getPlayerInfo(currentUser.uid);
   if (playerInfo && playerInfo.cards && playerInfo.cards.length === 2) {
    document.getElementById('card1').textContent = playerInfo.cards[0];
    document.getElementById('card2').textContent = playerInfo.cards[1];
    
    // Colorir cartas
    const card1 = document.getElementById('card1');
    const card2 = document.getElementById('card2');
    
    card1.style.color = playerInfo.cards[0].includes('‚ô•') || playerInfo.cards[0].includes('‚ô¶') ? '#e74c3c' : '#2c3e50';
    card2.style.color = playerInfo.cards[1].includes('‚ô•') || playerInfo.cards[1].includes('‚ô¶') ? '#e74c3c' : '#2c3e50';
   }
  }
  
  function checkPlayerTurn() {
   if (!pokerGame) return;
   
   const gameInfo = pokerGame.getGameInfo();
   const currentPlayerId = gameInfo.currentPlayerTurn;
   
   // Remover highlight de todos
   document.querySelectorAll('.avatar').forEach(avatar => {
    avatar.classList.remove('current-turn');
   });
   
   // Destacar jogador atual
   if (currentPlayerId) {
    const currentAvatar = document.querySelector(`[data-user-id="${currentPlayerId}"] .avatar`);
    if (currentAvatar) {
     currentAvatar.classList.add('current-turn');
    }
    
    // Verificar se √© a vez do usu√°rio atual
    if (currentPlayerId === currentUser.uid) {
     enablePlayerControls();
     startActionTimer();
     showNotification('‚úÖ SUA VEZ! Fa√ßa sua jogada', 'turn');
    } else {
     disablePlayerControls();
     stopActionTimer();
     
     // Mostrar quem est√° jogando
     const currentPlayer = tournamentData.players?.find(p => p.userId === currentPlayerId);
     if (currentPlayer) {
      showNotification(`${currentPlayer.nickname} est√° jogando...`, 'info');
     }
    }
   }
  }
  
  // =============================================
  // CONTROLES DO JOGADOR
  // =============================================
  
  function setupControls() {
   // Configurar slider de aposta
   const slider = document.getElementById('betSlider');
   if (slider) {
    slider.addEventListener('input', updateBetAmount);
   }
   
   // Configurar bot√µes
   document.getElementById('btnFold').addEventListener('click', () => playerAction('fold'));
   document.getElementById('btnCheck').addEventListener('click', () => playerAction('check'));
   document.getElementById('btnCall').addEventListener('click', () => playerAction('call'));
   document.getElementById('btnRaise').addEventListener('click', showRaiseControls);
   document.getElementById('btnAllin').addEventListener('click', () => playerAction('allin'));
  }
  
  async function playerAction(action) {
   if (!pokerGame || !isPlayerTurn()) {
    showNotification('N√£o √© sua vez!', 'error');
    return;
   }
   
   console.log(`üéÆ A√ß√£o: ${action}`);
   
   try {
    let amount = 0;
    
    // Para raise, usar valor do slider
    if (action === 'raise') {
     amount = parseInt(document.getElementById('betAmount').textContent);
     if (amount <= 0) {
      showNotification('Escolha um valor para raise', 'error');
      return;
     }
    }
    
    // Processar a√ß√£o
    const result = await pokerGame.playerAction(currentUser.uid, action, amount);
    
    if (result.success) {
     showNotification(`Voc√™ ${action}${amount > 0 ? ' ' + amount : ''}`, 'success');
     
     // Atualizar interface
     updatePot(result.gameState.pot);
     updatePlayerChips(currentUser.uid, result.player.chips);
     
     // Desabilitar controles temporariamente
     disablePlayerControls();
     hideRaiseControls();
     
     // Aguardar pr√≥ximo jogador
     setTimeout(() => {
      checkPlayerTurn();
     }, 1000);
     
    } else {
     showNotification(`Erro: ${result.error}`, 'error');
    }
    
   } catch (error) {
    console.error('‚ùå Erro na a√ß√£o:', error);
    showNotification('Erro: ' + error.message, 'error');
   }
  }
  
  function showRaiseControls() {
   if (!isPlayerTurn()) return;
   
   // Obter m√°ximo que pode apostar
   const playerInfo = pokerGame.getPlayerInfo(currentUser.uid);
   if (!playerInfo) return;
   
   const maxBet = playerInfo.chips;
   const minBet = pokerGame.getGameInfo().currentMaxBet || 100;
   
   // Configurar slider
   const slider = document.getElementById('betSlider');
   slider.min = minBet;
   slider.max = maxBet;
   slider.value = minBet;
   
   // Mostrar controles
   document.getElementById('raiseControls').style.display = 'flex';
   document.getElementById('actionButtons').style.display = 'none';
   
   // Atualizar valor
   updateBetAmount();
  }
  
  function hideRaiseControls() {
   document.getElementById('raiseControls').style.display = 'none';
   document.getElementById('actionButtons').style.display = 'flex';
  }
  
  function updateBetAmount() {
   const slider = document.getElementById('betSlider');
   const amount = parseInt(slider.value);
   document.getElementById('betAmount').textContent = amount;
  }
  
  function confirmRaise() {
   playerAction('raise');
  }
  
  function isPlayerTurn() {
   if (!pokerGame) return false;
   const gameInfo = pokerGame.getGameInfo();
   return gameInfo.currentPlayerTurn === currentUser.uid;
  }
  
  function enablePlayerControls() {
   const buttons = document.querySelectorAll('.action-btn');
   buttons.forEach(btn => {
    btn.disabled = false;
   });
   
   // Mostrar timer
   document.getElementById('actionTimerContainer').style.display = 'block';
  }
  
  function disablePlayerControls() {
   const buttons = document.querySelectorAll('.action-btn');
   buttons.forEach(btn => {
    btn.disabled = true;
   });
   
   // Esconder timer
   document.getElementById('actionTimerContainer').style.display = 'none';
  }
  
  // =============================================
  // TIMER DE A√á√ÉO
  // =============================================
  
  function startActionTimer() {
   timeLeft = 30;
   const timerBar = document.getElementById('actionTimerBar');
   timerBar.style.width = '100%';
   timerBar.style.background = '#2ecc71';
   
   stopActionTimer();
   
   actionTimerInterval = setInterval(() => {
    timeLeft--;
    const percentage = (timeLeft / 30) * 100;
    timerBar.style.width = percentage + '%';
    
    // Mudar cor conforme o tempo
    if (timeLeft <= 10) {
     timerBar.style.background = '#e74c3c';
    } else if (timeLeft <= 20) {
     timerBar.style.background = '#e67e22';
    }
    
    if (timeLeft <= 0) {
     // Tempo esgotado - fold autom√°tico
     playerAction('fold');
     stopActionTimer();
    }
   }, 1000);
  }
  
  function stopActionTimer() {
   if (actionTimerInterval) {
    clearInterval(actionTimerInterval);
    actionTimerInterval = null;
   }
  }
  
  // =============================================
  // FUN√á√ïES AUXILIARES
  // =============================================
  
  function updatePlayerChips(userId, chips) {
   const chipsElement = document.getElementById(`chips-${userId}`);
   if (chipsElement) {
    const nickname = chipsElement.textContent.split('\n')[0];
    chipsElement.innerHTML = `${nickname}<br>${chips}`;
   }
  }
  
  function showNotification(message, type = 'info') {
   const messageEl = document.getElementById('statusMessage');
   messageEl.textContent = message;
   messageEl.style.display = 'block';
   
   // Cor baseada no tipo
   if (type === 'error') {
    messageEl.style.background = 'rgba(231, 76, 60, 0.9)';
   } else if (type === 'success') {
    messageEl.style.background = 'rgba(46, 204, 113, 0.9)';
   } else if (type === 'turn') {
    messageEl.style.background = 'rgba(52, 152, 219, 0.9)';
   } else {
    messageEl.style.background = 'rgba(0,0,0,0.8)';
   }
   
   // Esconder ap√≥s 3 segundos (exceto para turnos)
   if (type !== 'turn') {
    setTimeout(() => {
     messageEl.style.display = 'none';
    }, 3000);
   }
  }
  
  // =============================================
  // LIMPEZA
  // =============================================
  window.addEventListener('beforeunload', () => {
   if (realtimeListener) {
    realtimeListener();
   }
   stopActionTimer();
  });
  
  console.log('‚úÖ Mesa de torneio carregada e pronta!');
 </script>
 
 <!-- Font Awesome para √≠cones -->
 <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/js/all.min.js"></script>
</body>
</html>